<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hist√≥rias por Cliente</title>

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      --overlay: rgba(15, 23, 42, 0.8);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --api-color: #8b5cf6;
      --danger-hover: #dc2626;
      --radius: 12px;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }

    body.dark {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --primary: #60a5fa;
      --primary-hover: #3b82f6;
      --border: #334155;
      --border-light: #2d3748;
      --overlay: rgba(0, 0, 0, 0.85);
      --api-color: #a78bfa;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Cabe√ßalho com menu hamb√∫rguer */
    .header {
      padding: 20px 0;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 32px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
    }

    /* Menu Hamb√∫rguer */
    .menu-toggle {
      background: none;
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--border-light);
    }

    .menu-toggle span {
      display: block;
      width: 22px;
      height: 2px;
      background: var(--text);
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    .menu-toggle.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .menu-toggle.active span:nth-child(2) {
      opacity: 0;
    }

    .menu-toggle.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Menu Lateral */
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .menu-sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 300px;
      height: 100%;
      background: var(--card);
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
    }

    .menu-sidebar.active {
      left: 0;
    }

    .menu-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-header h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }

    .menu-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-light);
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .menu-close:hover {
      background: var(--border-light);
      color: var(--text);
    }

    .menu-items {
      padding: 16px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 24px;
      color: var(--text);
      text-decoration: none;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
      border-left: 4px solid transparent;
    }

    .menu-item:hover {
      background: var(--border-light);
      border-left-color: var(--primary);
    }

    .menu-item.active {
      background: rgba(59, 130, 246, 0.1);
      border-left-color: var(--primary);
      color: var(--primary);
      font-weight: 600;
    }

    .menu-item-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .toggle {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 18px;
    }

    .toggle:hover {
      transform: rotate(15deg);
      box-shadow: var(--shadow);
    }

    /* Conte√∫do Principal */
    .main-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .main-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* SE√á√ÉO: Criar Nova Hist√≥ria */
    .section-creation {
      background: var(--card);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      height: fit-content;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-title::before {
      content: "‚úèÔ∏è";
      font-size: 18px;
    }

    /* SE√á√ÉO: Adicionar Cliente */
    .section-add-client {
      background: var(--card);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      height: fit-content;
    }

    .section-add-client .section-title::before {
      content: "üë§";
      font-size: 18px;
    }

    /* Formul√°rio de cliente */
    .client-form {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 32px;
      padding-bottom: 32px;
      border-bottom: 1px solid var(--border-light);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group label::before {
      content: "‚Üí";
      color: var(--primary);
      font-weight: bold;
    }

    input,
    textarea,
    select,
    button {
      font-family: inherit;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      transition: all 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    input,
    select {
      padding: 12px 16px;
      height: 46px;
    }

    /* √Årea de cria√ß√£o de hist√≥rias */
    .story-creation {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .story-form-header {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    /* Barra de ferramentas de formata√ß√£o */
    .formatting-toolbar {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: var(--border-light);
      border-radius: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .format-btn {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.2s ease;
    }

    .format-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .format-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .format-btn.list-btn {
      width: auto;
      padding: 0 12px;
      font-size: 13px;
    }

    .divider {
      width: 1px;
      height: 20px;
      background: var(--border);
      margin: 0 4px;
    }

    /* √Årea de texto grande */
    .story-textarea-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    #texto {
      width: 100%;
      min-height: 300px;
      padding: 20px;
      font-family: inherit;
      font-size: 15px;
      line-height: 1.6;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
      color: var(--text);
      resize: vertical;
      transition: border-color 0.2s ease;
    }

    #texto:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .story-form-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    button {
      padding: 12px 24px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border: none;
      transition: all 0.2s ease;
    }

    button.primary {
      background: var(--primary);
      color: white;
    }

    button.primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    button.secondary {
      background: var(--border-light);
      color: var(--text);
    }

    button.secondary:hover {
      background: var(--border);
    }

    button.danger {
      background: var(--danger);
      color: white;
    }

    button.danger:hover {
      background: var(--danger-hover);
    }

    button.small {
      padding: 8px 16px;
      font-size: 14px;
    }

    button.full-width {
      width: 100%;
    }

    /* SE√á√ÉO: Visualiza√ß√£o dos Cards */
    .section-cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .cards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
    }

    .cards-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0;
    }

    .cards-header h2::before {
      content: "üìã";
      font-size: 20px;
    }

    .client-selector {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* ===== FILTROS MODIFICADOS - LADO DO T√çTULO ===== */
    .filters-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
      padding: 0;
    }

    .filter-group label {
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      font-size: 13px;
      min-width: auto;
    }

    #clienteSelectCards,
    #statusFilter {
      min-width: 150px;
      padding: 6px 10px;
      font-size: 13px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    #clienteSelectCards:hover,
    #statusFilter:hover {
      border-color: var(--primary);
    }

    #clienteSelectCards:focus,
    #statusFilter:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .cards-container {
      flex: 1;
      margin-top: 16px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 24px;
    }

    /* CARD MODIFICADO - Sem pr√©via do conte√∫do */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border-top: 4px solid var(--border);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .card[data-status="Resolvido"] {
      border-top-color: var(--success);
    }

    .card[data-status="Importante"] {
      border-top-color: var(--warning);
    }

    .card[data-status="Pendente"] {
      border-top-color: var(--danger);
    }

    .card[data-status="API"] {
      border-top-color: var(--api-color);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .card h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
      margin-right: 12px;
    }

    /* Status badge */
    .status {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      background: var(--border-light);
      white-space: nowrap;
    }

    .status[data-status="Resolvido"] {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status[data-status="Importante"] {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .status[data-status="Pendente"] {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .status[data-status="API"] {
      background: rgba(139, 92, 246, 0.1);
      color: var(--api-color);
    }

    /* Informa√ß√µes de data */
    .card-dates {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 20px;
      padding: 12px;
      background: var(--border-light);
      border-radius: 8px;
      font-size: 13px;
    }

    .date-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-light);
    }

    .date-info .label {
      font-weight: 600;
      color: var(--text);
      min-width: 70px;
    }

    .date-info .value {
      flex: 1;
    }

    /* A√ß√µes do card */
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    /* Estado vazio */
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--text-light);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: var(--text);
    }

    .empty-state p {
      max-width: 400px;
      margin: 0 auto;
    }

    /* ===== MODAL DE EDI√á√ÉO MODIFICADO ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-box {
      background: var(--card);
      border-radius: var(--radius);
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      animation: modalSlideUp 0.3s ease;
    }

    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 20px 32px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--border-light);
    }

    .modal-header h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-header h2::before {
      content: "üìù";
      font-size: 18px;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-light);
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text);
    }

    .modal-body {
      padding: 24px 32px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .modal-main-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .modal-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .form-section-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
      text-transform: none;
      letter-spacing: normal;
      margin: 0;
    }

    /* Status no modal - minimalista na mesma linha */
    .modal-status-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-status-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-light);
    }

    #editStatus {
      padding: 4px 10px;
      font-size: 13px;
      height: 30px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      font-weight: 500;
      min-width: 120px;
      transition: all 0.2s ease;
    }

    #editStatus:hover {
      border-color: var(--primary);
    }

    #editStatus:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .form-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* √Årea de texto edit√°vel no modal - sem barra de formata√ß√£o */
    .modal-editable-content {
      width: 100%;
      min-height: 300px;
      padding: 16px;
      font-family: inherit;
      font-size: 15px;
      line-height: 1.6;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--card);
      color: var(--text);
      resize: vertical;
      transition: all 0.2s ease;
      overflow-y: auto;
      outline: none;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .modal-editable-content:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Estilos para conte√∫do formatado dentro da √°rea edit√°vel */
    .modal-editable-content strong {
      font-weight: bold;
    }

    .modal-editable-content em {
      font-style: italic;
    }

    .modal-editable-content del {
      text-decoration: line-through;
    }

    .modal-editable-content ul {
      list-style-type: disc;
      padding-left: 20px;
      margin: 8px 0;
    }

    .modal-editable-content ol {
      list-style-type: decimal;
      padding-left: 20px;
      margin: 8px 0;
    }

    .modal-editable-content li {
      margin-bottom: 4px;
    }

    /* Garantir que as quebras de linha sejam vis√≠veis */
    .modal-editable-content br {
      display: block;
      content: "";
      margin-top: 0;
    }

    .modal-footer {
      padding: 16px 32px;
      border-top: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--border-light);
    }

    .client-info {
      color: var(--text-light);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .client-info strong {
      color: var(--text);
      font-weight: 600;
    }

    .modal-footer-actions {
      display: flex;
      gap: 10px;
    }

    .modal-footer-actions button {
      padding: 8px 20px;
      font-size: 13px;
      border-radius: 6px;
      font-weight: 600;
    }

    /* Responsividade para os filtros */
    @media (max-width: 1024px) {
      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        justify-content: flex-start;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 140px;
      }

      .modal-box {
        max-width: 95%;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }

      .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .filter-group {
        width: 100%;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 100%;
        width: 100%;
      }

      .modal-header,
      .modal-body,
      .modal-footer {
        padding: 16px;
      }

      .modal-box {
        max-width: 98%;
      }

      .form-section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .modal-status-container {
        width: 100%;
        justify-content: space-between;
      }

      .menu-sidebar {
        width: 280px;
      }

      .menu-item {
        padding: 14px 20px;
      }

      .card-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .card h3 {
        margin-right: 0;
      }

      .status {
        align-self: flex-start;
      }
    }

    @media (max-width: 480px) {
      .cards-grid {
        grid-template-columns: 1fr;
      }

      .menu-sidebar {
        width: 260px;
      }

      .header-left {
        gap: 12px;
      }

      .header h1 {
        font-size: 24px;
      }

      .cards-header h2 {
        font-size: 20px;
      }

      .filter-group label {
        font-size: 12px;
      }

      #clienteSelectCards,
      #statusFilter {
        font-size: 12px;
        padding: 6px 8px;
        height: 30px;
      }

      .modal-editable-content {
        min-height: 250px;
      }
    }

    @media (max-width: 1024px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
    }
  </style>
</head>

<body>

  <!-- Menu Hamb√∫rguer Overlay -->
  <div class="menu-overlay" id="menuOverlay"></div>

  <!-- Menu Lateral -->
  <div class="menu-sidebar" id="menuSidebar">
    <div class="menu-header">
      <h2>Menu</h2>
      <button class="menu-close" id="menuClose">√ó</button>
    </div>
    <div class="menu-items">
      <div class="menu-item active" data-section="historias-salvas">
        <span class="menu-item-icon">üìã</span>
        <span>Hist√≥rias Salvas</span>
      </div>
      <div class="menu-item" data-section="criar-historia">
        <span class="menu-item-icon">‚úèÔ∏è</span>
        <span>Criar Nova Hist√≥ria</span>
      </div>
      <div class="menu-item" data-section="adicionar-cliente">
        <span class="menu-item-icon">üë§</span>
        <span>Adicionar Cliente</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <h1>Hist√≥rias por Cliente</h1>
        </div>
        <div class="header-right">
          <button class="toggle" onclick="toggleDark()" title="Alternar tema">üåô</button>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Hist√≥rias Salvas (vis√≠vel por padr√£o) -->
    <div class="main-content active" id="historias-salvas">
      <div class="section-cards">
        <div class="cards-header">
          <h2>Hist√≥rias Salvas</h2>

          <!-- Filtros agora ao lado do t√≠tulo -->
          <div class="filters-container">
            <div class="filter-group">
              <label for="clienteSelectCards">Cliente:</label>
              <select id="clienteSelectCards" onchange="renderCards()">
                <option value="">Todos</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="statusFilter">Status:</label>
              <select id="statusFilter" onchange="renderCards()">
                <option value="">Todos</option>
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>
          </div>
        </div>

        <div class="cards-container">
          <div class="cards-grid" id="cards">
            <!-- Cards ser√£o renderizados aqui -->
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Criar Nova Hist√≥ria (oculto por padr√£o) -->
    <div class="main-content" id="criar-historia">
      <div class="section-creation">
        <h2 class="section-title">Criar Nova Hist√≥ria</h2>

        <!-- Formul√°rio de Criar Hist√≥rias -->
        <div class="story-creation">
          <div class="story-form-header">
            <div class="form-group">
              <label for="clienteSelect">Cliente</label>
              <select id="clienteSelect">
                <option value="">Selecione um cliente</option>
              </select>
            </div>

            <div class="form-group">
              <label for="titulo">T√≠tulo da Hist√≥ria</label>
              <input id="titulo" placeholder="Digite o t√≠tulo">
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <select id="status">
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>
          </div>

          <div class="story-form-content">
            <!-- Barra de ferramentas de formata√ß√£o -->
            <div class="formatting-toolbar">
              <button class="format-btn" data-format="bold" title="Negrito">B</button>
              <button class="format-btn" data-format="italic" title="It√°lico">I</button>
              <button class="format-btn" data-format="strike" title="Tachado">S</button>
              <div class="divider"></div>
              <button class="format-btn list-btn" data-format="ul" title="Lista com marcadores">‚Ä¢ Lista</button>
              <button class="format-btn list-btn" data-format="ol" title="Lista numerada">1. Lista</button>
            </div>

            <!-- √Årea de texto grande -->
            <div class="story-textarea-container">
              <textarea id="texto" placeholder="Detalhes da hist√≥ria... (Use os bot√µes acima para formatar o texto)"></textarea>
            </div>
          </div>

          <div class="story-form-actions">
            <button class="primary full-width" onclick="addCard()">Salvar Hist√≥ria</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Adicionar Cliente (nova se√ß√£o) -->
    <div class="main-content" id="adicionar-cliente">
      <div class="section-add-client">
        <h2 class="section-title">Adicionar Cliente</h2>

        <!-- Formul√°rio de Adicionar Cliente -->
        <div class="client-form">
          <div class="form-group">
            <label for="clienteNome">Nome do Cliente</label>
            <div style="display: flex; gap: 12px;">
              <input id="clienteNome" placeholder="Digite o nome do cliente">
              <button class="primary" onclick="addCliente()" style="white-space: nowrap;">Adicionar Cliente</button>
            </div>
          </div>
          <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">
            ‚ìò Ap√≥s adicionar um cliente, voc√™ poder√° selecion√°-lo na se√ß√£o "Criar Nova Hist√≥ria".
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE EDI√á√ÉO MODIFICADO -->
  <div class="modal" id="modal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>Editar Hist√≥ria</h2>
        <button class="modal-close" onclick="fecharModal()">√ó</button>
      </div>

      <div class="modal-body">
        <div class="modal-main-content">
          <div class="modal-form">
            <div class="form-section">
              <div class="form-section-header">
                <h3>Informa√ß√µes da Hist√≥ria</h3>
                <div class="modal-status-container">
                  <span class="modal-status-label">Status:</span>
                  <select id="editStatus">
                    <option value="Pendente">Pendente</option>
                    <option value="Resolvido">Resolvido</option>
                    <option value="Importante">Importante</option>
                    <option value="API">API</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="editTitulo">T√≠tulo</label>
                <input id="editTitulo" placeholder="Digite o t√≠tulo da hist√≥ria">
              </div>

              <div class="form-group">
                <label for="editTexto">Conte√∫do</label>
                <!-- √Årea edit√°vel - sem barra de formata√ß√£o -->
                <div id="editTexto" class="modal-editable-content" contenteditable="true" placeholder="Descreva os detalhes da hist√≥ria..."></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="client-info">
          <span>Editando hist√≥ria de:</span>
          <strong id="currentClienteName"></strong>
        </div>

        <div class="modal-footer-actions">
          <button class="secondary" onclick="fecharModal()">Cancelar</button>
          <button class="primary" onclick="salvarEdicao()">Salvar Altera√ß√µes</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let dados = JSON.parse(localStorage.getItem("clientes")) || {};
    let editCliente = null;
    let editIndex = null;

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function () {
      if (localStorage.getItem("dark") === "true") {
        document.body.classList.add("dark");
        document.querySelector('.toggle').textContent = '‚òÄÔ∏è';
      }
      atualizarSelects();
      renderCards();
      setupFormattingButtons();
      setupMenu();
      setupModalEvents();
    });

    // Configurar menu hamb√∫rguer
    function setupMenu() {
      const menuToggle = document.getElementById('menuToggle');
      const menuClose = document.getElementById('menuClose');
      const menuOverlay = document.getElementById('menuOverlay');
      const menuSidebar = document.getElementById('menuSidebar');
      const menuItems = document.querySelectorAll('.menu-item');
      const sections = document.querySelectorAll('.main-content');

      // Abrir menu
      menuToggle.addEventListener('click', function () {
        menuSidebar.classList.add('active');
        menuOverlay.classList.add('active');
        menuToggle.classList.add('active');
      });

      // Fechar menu
      function closeMenu() {
        menuSidebar.classList.remove('active');
        menuOverlay.classList.remove('active');
        menuToggle.classList.remove('active');
      }

      menuClose.addEventListener('click', closeMenu);
      menuOverlay.addEventListener('click', closeMenu);

      // Navegar entre se√ß√µes
      menuItems.forEach(item => {
        item.addEventListener('click', function () {
          const sectionId = this.dataset.section;

          // Atualizar item ativo no menu
          menuItems.forEach(i => i.classList.remove('active'));
          this.classList.add('active');

          // Mostrar se√ß√£o correspondente
          sections.forEach(section => {
            section.classList.remove('active');
            if (section.id === sectionId) {
              section.classList.add('active');
            }
          });

          // Fechar menu
          closeMenu();
        });
      });
    }

    function setupFormattingButtons() {
      const formatButtons = document.querySelectorAll('.format-btn');
      const textarea = document.getElementById('texto');

      formatButtons.forEach(button => {
        button.addEventListener('click', function () {
          const format = this.dataset.format;
          applyFormatting(format, textarea);

          // Feedback visual
          formatButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          setTimeout(() => {
            this.classList.remove('active');
          }, 200);
        });
      });
    }

    function applyFormatting(format, textarea) {
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      let formattedText = '';

      switch (format) {
        case 'bold':
          formattedText = `**${selectedText}**`;
          break;
        case 'italic':
          formattedText = `*${selectedText}*`;
          break;
        case 'strike':
          formattedText = `~~${selectedText}~~`;
          break;
        case 'ul':
          formattedText = selectedText.split('\n').map(line => `‚Ä¢ ${line}`).join('\n');
          break;
        case 'ol':
          formattedText = selectedText.split('\n').map((line, i) => `${i + 1}. ${line}`).join('\n');
          break;
      }

      // Substituir o texto selecionado
      textarea.value = textarea.value.substring(0, start) +
        formattedText +
        textarea.value.substring(end);

      // Restaurar o foco e sele√ß√£o
      textarea.focus();
      textarea.setSelectionRange(start, start + formattedText.length);
    }

    // Fun√ß√£o para converter HTML para markdown preservando formata√ß√£o
    function htmlToMarkdown(html) {
      // Criar um elemento tempor√°rio para manipula√ß√£o
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;

      // Fun√ß√£o recursiva para converter elementos
      function convertNode(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          return node.textContent;
        }

        if (node.nodeType === Node.ELEMENT_NODE) {
          const tagName = node.tagName.toLowerCase();
          const children = Array.from(node.childNodes);
          const content = children.map(convertNode).join('');

          switch (tagName) {
            case 'strong':
            case 'b':
              return `**${content}**`;
            case 'em':
            case 'i':
              return `*${content}*`;
            case 'del':
            case 'strike':
              return `~~${content}~~`;
            case 'ul':
              const listItems = Array.from(node.querySelectorAll('li'));
              return listItems.map(li => `‚Ä¢ ${convertNode(li)}`).join('\n') + '\n';
            case 'ol':
              const olItems = Array.from(node.querySelectorAll('li'));
              return olItems.map((li, i) => `${i + 1}. ${convertNode(li)}`).join('\n') + '\n';
            case 'li':
              return Array.from(node.childNodes).map(convertNode).join('');
            case 'br':
              return '\n';
            case 'div':
            case 'p':
              return content + '\n\n';
            default:
              return content;
          }
        }

        return '';
      }

      let markdown = convertNode(tempDiv);

      // Limpar m√∫ltiplas quebras de linha
      markdown = markdown.replace(/\n\s*\n\s*\n/g, '\n\n');
      markdown = markdown.trim();

      return markdown;
    }

    // Fun√ß√£o para converter markdown para HTML preservando formata√ß√£o
    function markdownToHtml(markdown) {
      let html = markdown;

      // Primeiro, converter quebras de linha para <br>
      html = html.replace(/\n/g, '<br>');

      // Converter formata√ß√£o - usando regex mais robustos
      // Negrito: **texto** ou __texto__
      html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');

      // It√°lico: *texto* ou _texto_
      html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
      html = html.replace(/_(.*?)_/g, '<em>$1</em>');

      // Tachado: ~~texto~~
      html = html.replace(/~~(.*?)~~/g, '<del>$1</del>');

      // Listas com marcadores
      html = html.replace(/^‚Ä¢ (.*?)$/gm, '<li>$1</li>');
      html = html.replace(/^\* (.*?)$/gm, '<li>$1</li>');
      html = html.replace(/^- (.*?)$/gm, '<li>$1</li>');

      // Listas numeradas
      html = html.replace(/^(\d+)\. (.*?)$/gm, '<li>$2</li>');

      // Adicionar tags de lista se houver itens de lista
      if (html.includes('<li>')) {
        // Encontrar onde come√ßa e termina as listas
        const lines = html.split('<br>');
        let inList = false;
        let result = [];

        for (let i = 0; i < lines.length; i++) {
          if (lines[i].includes('<li>')) {
            if (!inList) {
              result.push('<ul>');
              inList = true;
            }
            result.push(lines[i]);
          } else {
            if (inList) {
              result.push('</ul>');
              inList = false;
            }
            result.push(lines[i]);
          }
        }

        if (inList) {
          result.push('</ul>');
        }

        html = result.join('<br>');
      }

      return html;
    }

    // Fun√ß√£o para limpar e preservar HTML para √°rea edit√°vel
    function prepareHtmlForEditable(html) {
      // Garantir que as quebras de linha sejam preservadas
      let cleanHtml = html;

      // Converter m√∫ltiplos <br> seguidos para um √∫nico <br>
      cleanHtml = cleanHtml.replace(/(<br\s*\/?>\s*){2,}/gi, '<br><br>');

      // Garantir formata√ß√£o consistente
      cleanHtml = cleanHtml.replace(/<b>/g, '<strong>').replace(/<\/b>/g, '</strong>');
      cleanHtml = cleanHtml.replace(/<i>/g, '<em>').replace(/<\/i>/g, '</em>');
      cleanHtml = cleanHtml.replace(/<strike>/g, '<del>').replace(/<\/strike>/g, '</del>');

      return cleanHtml;
    }

    function setupModalEvents() {
      const modal = document.getElementById('modal');
      const modalBox = modal.querySelector('.modal-box');
      const closeBtn = modal.querySelector('.modal-close');

      // Fechar com bot√£o X
      closeBtn.addEventListener('click', fecharModal);

      // Fechar com ESC
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape' && modal.classList.contains('active')) {
          fecharModal();
        }
      });

      // PREVENIR fechamento ao clicar fora do modal
      modal.addEventListener('click', function (event) {
        if (event.target === modal) {
          event.stopPropagation();
        }
      });

      // Permitir intera√ß√£o dentro do modal
      modalBox.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    function salvar() {
      localStorage.setItem("clientes", JSON.stringify(dados));
    }

    function toggleDark() {
      const body = document.body;
      const toggleBtn = document.querySelector('.toggle');

      body.classList.toggle("dark");
      toggleBtn.textContent = body.classList.contains("dark") ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem("dark", body.classList.contains("dark"));
    }

    function atualizarSelects() {
      // Atualizar select da se√ß√£o de cria√ß√£o
      const selectCriacao = document.getElementById('clienteSelect');
      selectCriacao.innerHTML = '<option value="">Selecione um cliente</option>';

      // Atualizar select da se√ß√£o de cards (filtro por cliente)
      const selectClienteCards = document.getElementById('clienteSelectCards');
      selectClienteCards.innerHTML = '<option value="">Todos</option>';

      Object.keys(dados).sort().forEach(cliente => {
        // Para select de cria√ß√£o
        const option1 = document.createElement('option');
        option1.value = cliente;
        option1.textContent = cliente;
        selectCriacao.appendChild(option1);

        // Para select de visualiza√ß√£o (filtro por cliente)
        const option2 = document.createElement('option');
        option2.value = cliente;
        option2.textContent = cliente;
        selectClienteCards.appendChild(option2);
      });

      // O filtro por status j√° est√° configurado no HTML
    }

    function addCliente() {
      const nomeInput = document.getElementById('clienteNome');
      const nome = nomeInput.value.trim();

      if (!nome) {
        alert('Por favor, digite um nome para o cliente.');
        nomeInput.focus();
        return;
      }

      if (dados[nome]) {
        alert('J√° existe um cliente com esse nome.');
        nomeInput.focus();
        return;
      }

      dados[nome] = [];
      salvar();
      atualizarSelects();
      nomeInput.value = "";

      // Focar novamente no campo ap√≥s adicionar
      nomeInput.focus();

      // Mostrar mensagem de sucesso
      alert(`Cliente "${nome}" adicionado com sucesso!`);
    }

    function addCard() {
      const cliente = document.getElementById('clienteSelect').value;
      if (!cliente) {
        alert('Selecione um cliente primeiro.');
        return;
      }

      const titulo = document.getElementById('titulo').value.trim();
      const texto = document.getElementById('texto').value;
      const status = document.getElementById('status').value;

      if (!titulo) {
        alert('Por favor, digite um t√≠tulo para a hist√≥ria.');
        document.getElementById('titulo').focus();
        return;
      }

      // Converter formata√ß√£o markdown para HTML
      const textoFormatado = formatText(texto);
      const dataAtual = new Date().toISOString().split('T')[0];
      const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      dados[cliente].push({
        titulo: titulo,
        texto: textoFormatado,
        textoOriginal: texto,
        status: status,
        dataCriacao: dataAtual,
        horaCriacao: horaAtual,
        dataEdicao: dataAtual,
        horaEdicao: horaAtual,
        cliente: cliente
      });

      salvar();
      renderCards();

      // Limpa os campos, mas mant√©m o cliente selecionado
      document.getElementById('titulo').value = '';
      document.getElementById('texto').value = '';

      // Foco no t√≠tulo para pr√≥xima hist√≥ria
      document.getElementById('titulo').focus();

      // Voltar para a se√ß√£o de hist√≥rias salvas ap√≥s criar
      document.querySelector('.menu-item[data-section="historias-salvas"]').click();
    }

    function formatText(text) {
      // Converter markdown simples para HTML
      let formatted = text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/~~(.*?)~~/g, '<del>$1</del>')
        .replace(/^‚Ä¢ (.*?)$/gm, '<li>$1</li>')
        .replace(/^(\d+)\. (.*?)$/gm, '<li>$2</li>');

      // Adicionar tags de lista
      if (formatted.includes('<li>')) {
        formatted = '<ul>' + formatted.replace(/<\/li>\s*<li>/g, '</li><li>') + '</ul>';
      }

      // Manter quebras de linha
      formatted = formatted.replace(/\n/g, '<br>');

      return formatted;
    }

    function renderCards() {
      const container = document.getElementById('cards');
      const clienteSelecionado = document.getElementById('clienteSelectCards').value;
      const statusSelecionado = document.getElementById('statusFilter').value;

      // Verificar se h√° dados
      const totalHistorias = Object.values(dados).reduce((total, arr) => total + arr.length, 0);

      if (totalHistorias === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>Adicione clientes e crie hist√≥rias usando o menu.</p>
          </div>
        `;
        return;
      }

      // Se h√° dados mas nenhum filtro selecionado, mostrar todos
      if (!clienteSelecionado && !statusSelecionado) {
        mostrarTodasHistorias(container);
      } else {
        mostrarHistoriasFiltradas(container, clienteSelecionado, statusSelecionado);
      }
    }

    function mostrarTodasHistorias(container) {
      container.innerHTML = '';

      Object.keys(dados).forEach(cliente => {
        if (dados[cliente].length > 0) {
          // Adicionar t√≠tulo do cliente
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin: 16px 0 8px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
          `;
          clienteTitle.textContent = `Cliente: ${cliente}`;
          container.appendChild(clienteTitle);

          // Adicionar cards do cliente
          dados[cliente].forEach((historia, index) => {
            container.appendChild(criarCardElement(cliente, historia, index));
          });
        }
      });
    }

    function mostrarHistoriasFiltradas(container, clienteFiltro, statusFiltro) {
      container.innerHTML = '';

      let historiasFiltradas = [];
      let clientesComHistorias = [];

      // Coletar todas as hist√≥rias que correspondem aos filtros
      Object.keys(dados).forEach(cliente => {
        if (!clienteFiltro || cliente === clienteFiltro) {
          dados[cliente].forEach(historia => {
            if (!statusFiltro || historia.status === statusFiltro) {
              historiasFiltradas.push({
                cliente: cliente,
                historia: historia,
                index: dados[cliente].indexOf(historia)
              });

              if (!clientesComHistorias.includes(cliente)) {
                clientesComHistorias.push(cliente);
              }
            }
          });
        }
      });

      if (historiasFiltradas.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>N√£o h√° hist√≥rias que correspondam aos filtros selecionados.</p>
          </div>
        `;
        return;
      }

      // Mostrar por cliente ou todas juntas dependendo dos filtros
      if (clienteFiltro) {
        // Filtro por cliente espec√≠fico
        const clienteTitle = document.createElement('div');
        clienteTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 18px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

        let titulo = `Cliente: ${clienteFiltro}`;
        if (statusFiltro) {
          titulo += ` (Filtrado por status: ${statusFiltro})`;
        }
        titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

        clienteTitle.textContent = titulo;
        container.appendChild(clienteTitle);

        // Adicionar cards filtrados
        historiasFiltradas.forEach(item => {
          container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
        });
      } else {
        // Filtro apenas por status (ou nenhum filtro)
        const filtroTitle = document.createElement('div');
        filtroTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 18px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

        let titulo = 'Todas as hist√≥rias';
        if (statusFiltro) {
          titulo = `Hist√≥rias com status: ${statusFiltro}`;
        }
        titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

        filtroTitle.textContent = titulo;
        container.appendChild(filtroTitle);

        // Agrupar por cliente para melhor organiza√ß√£o
        const historiasPorCliente = {};

        historiasFiltradas.forEach(item => {
          if (!historiasPorCliente[item.cliente]) {
            historiasPorCliente[item.cliente] = [];
          }
          historiasPorCliente[item.cliente].push(item);
        });

        // Adicionar cards agrupados por cliente
        Object.keys(historiasPorCliente).forEach(cliente => {
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin: 20px 0 8px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
          `;
          clienteTitle.textContent = `Cliente: ${cliente}`;
          container.appendChild(clienteTitle);

          historiasPorCliente[cliente].forEach(item => {
            container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
          });
        });
      }
    }

    function criarCardElement(cliente, historia, index) {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.status = historia.status;

      // Formatar data para exibi√ß√£o
      const dataCriacao = historia.dataCriacao || 'N√£o informado';
      const horaCriacao = historia.horaCriacao || '';
      const dataEdicao = historia.dataEdicao || dataCriacao;
      const horaEdicao = historia.horaEdicao || horaCriacao;

      card.innerHTML = `
        <div class="card-header">
          <h3>${historia.titulo}</h3>
          <span class="status" data-status="${historia.status}">${historia.status}</span>
        </div>
        
        <div class="card-dates">
          <div class="date-info">
            <span class="label">Criado em:</span>
            <span class="value">${dataCriacao} ${horaCriacao ? `√†s ${horaCriacao}` : ''}</span>
          </div>
          <div class="date-info">
            <span class="label">Editado em:</span>
            <span class="value">${dataEdicao} ${horaEdicao ? `√†s ${horaEdicao}` : ''}</span>
          </div>
        </div>
        
        <div class="card-footer">
          <div class="card-actions">
            <button class="secondary small" onclick="abrirModal('${cliente}', ${index})">Editar</button>
            <button class="danger small" onclick="excluir('${cliente}', ${index})">Excluir</button>
          </div>
        </div>
      `;

      return card;
    }

    function excluir(cliente, index) {
      if (!confirm("Tem certeza que deseja excluir esta hist√≥ria?")) return;

      dados[cliente].splice(index, 1);
      salvar();
      renderCards();

      // Atualizar selects se o cliente ficou sem hist√≥rias
      if (dados[cliente].length === 0) {
        atualizarSelects();
      }
    }

    function abrirModal(cliente, index) {
      editCliente = cliente;
      editIndex = index;

      const historia = dados[cliente][index];
      document.getElementById('editTitulo').value = historia.titulo;

      // Converter markdown para HTML e colocar na √°rea edit√°vel
      const htmlContent = markdownToHtml(historia.textoOriginal || historia.texto);
      const cleanHtml = prepareHtmlForEditable(htmlContent);
      document.getElementById('editTexto').innerHTML = cleanHtml;

      document.getElementById('editStatus').value = historia.status;
      document.getElementById('currentClienteName').textContent = cliente;

      document.getElementById('modal').classList.add('active');

      // Foco no conte√∫do (√°rea edit√°vel) ao abrir o modal
      setTimeout(() => {
        document.getElementById('editTexto').focus();
        // Colocar o cursor no in√≠cio do texto
        const range = document.createRange();
        const sel = window.getSelection();
        range.setStart(document.getElementById('editTexto'), 0);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
      }, 100);
    }

    function fecharModal() {
      document.getElementById('modal').classList.remove('active');
    }

    function salvarEdicao() {
      const titulo = document.getElementById('editTitulo').value.trim();

      if (!titulo) {
        alert('O t√≠tulo √© obrigat√≥rio.');
        document.getElementById('editTitulo').focus();
        return;
      }

      // Obter HTML da √°rea edit√°vel e converter para markdown
      const htmlContent = document.getElementById('editTexto').innerHTML;
      const markdownContent = htmlToMarkdown(htmlContent);
      const textoFormatado = formatText(markdownContent);

      const dataAtual = new Date().toISOString().split('T')[0];
      const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      // Preservar dados existentes e atualizar
      const historiaExistente = dados[editCliente][editIndex];

      dados[editCliente][editIndex] = {
        titulo: titulo,
        texto: textoFormatado,
        textoOriginal: markdownContent, // Salvar em markdown para edi√ß√£o futura
        status: document.getElementById('editStatus').value,
        dataCriacao: historiaExistente.dataCriacao || dataAtual,
        horaCriacao: historiaExistente.horaCriacao || horaAtual,
        dataEdicao: dataAtual,
        horaEdicao: horaAtual,
        cliente: editCliente
      };

      salvar();
      fecharModal();
      renderCards();
    }

    // Fechar modal com ESC
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Escape' && document.getElementById('modal').classList.contains('active')) {
        fecharModal();
      }
    });

    // PREVENIR fechamento ao clicar fora do modal
    document.getElementById('modal').addEventListener('click', function (event) {
      if (event.target === this) {
        // N√£o faz nada - impede o fechamento
        event.stopPropagation();
      }
    });

  </script>

</body>

</html>
