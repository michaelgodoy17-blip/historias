<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hist√≥rias por Cliente</title>

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      --overlay: rgba(15, 23, 42, 0.8);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --api-color: #8b5cf6;
      --danger-hover: #dc2626;
      --radius: 8px;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.12);
      --expand-color: #3b82f6;
      --note-bg: #f0f9ff;
      --note-border: #bae6fd;
      --review-soon: #f59e0b;
      --review-today: #ef4444;
      --review-future: #10b981;
      --filter-active: #3b82f6;
      --filter-badge: #ef4444;
    }

    body.dark {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --primary: #60a5fa;
      --primary-hover: #3b82f6;
      --border: #334155;
      --border-light: #2d3748;
      --overlay: rgba(0, 0, 0, 0.85);
      --api-color: #a78bfa;
      --expand-color: #60a5fa;
      --note-bg: #1e3a5f;
      --note-border: #2563eb;
      --review-soon: #f59e0b;
      --review-today: #ef4444;
      --review-future: #10b981;
      --filter-active: #60a5fa;
      --filter-badge: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Cabe√ßalho com menu hamb√∫rguer */
    .header {
      padding: 16px 0;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 24px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
    }

    /* Menu Hamb√∫rguer */
    .menu-toggle {
      background: none;
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--border-light);
    }

    .menu-toggle span {
      display: block;
      width: 22px;
      height: 2px;
      background: var(--text);
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    .menu-toggle.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .menu-toggle.active span:nth-child(2) {
      opacity: 0;
    }

    .menu-toggle.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Menu Lateral */
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .menu-sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 300px;
      height: 100%;
      background: var(--card);
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
    }

    .menu-sidebar.active {
      left: 0;
    }

    .menu-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-header h2 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
    }

    .menu-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-light);
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .menu-close:hover {
      background: var(--border-light);
      color: var(--text);
    }

    .menu-items {
      padding: 12px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      color: var(--text);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
      border-left: 4px solid transparent;
    }

    .menu-item:hover {
      background: var(--border-light);
      border-left-color: var(--primary);
    }

    .menu-item.active {
      background: rgba(59, 130, 246, 0.1);
      border-left-color: var(--primary);
      color: var(--primary);
      font-weight: 600;
    }

    .menu-item-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    /* Conte√∫do Principal */
    .main-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .main-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* SE√á√ÉO: Criar Nova Hist√≥ria - LAYOUT SIMPLIFICADO */
    .section-creation {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title::before {
      content: "‚úèÔ∏è";
      font-size: 16px;
    }

    /* SE√á√ÉO: Adicionar Pessoas */
    .section-add-client {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-add-client .section-title::before {
      content: "üë•";
      font-size: 16px;
    }

    /* Estilos para as abas de Adicionar Pessoas */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border-light);
      padding-bottom: 10px;
    }

    .tab-btn {
      padding: 10px 20px;
      background: var(--border-light);
      color: var(--text);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .tab-btn:hover {
      background: var(--border);
    }

    .tab-btn.active {
      background: var(--primary);
      color: white;
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    /* Layout para as duas abas lado a lado em telas grandes */
    @media (min-width: 768px) {
      .people-options {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .tabs {
        justify-content: flex-start;
      }
    }

    @media (max-width: 767px) {
      .tabs {
        flex-direction: column;
      }

      .tab-btn {
        width: 100%;
        text-align: center;
      }
    }

    /* SE√á√ÉO: Gerenciar Dados */
    .section-data-management {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-data-management .section-title::before {
      content: "üíæ";
      font-size: 16px;
    }

    /* Formul√°rio de cliente */
    .client-form,
    .team-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group label::before {
      content: "‚Üí";
      color: var(--primary);
      font-weight: bold;
      font-size: 12px;
    }

    input,
    textarea,
    select,
    button {
      font-family: inherit;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      transition: all 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    input,
    select {
      padding: 10px 12px;
      height: 42px;
    }

    /* √Årea de cria√ß√£o de hist√≥rias - LAYOUT SIMPLIFICADO */
    .story-creation {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* REMOVIDA a barra de ferramentas de formata√ß√£o */

    /* √Årea de texto grande - PRIMEIRO no layout */
    .story-textarea-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    #texto {
      width: 100%;
      min-height: 200px;
      padding: 16px;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.6;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
      color: var(--text);
      resize: vertical;
      transition: border-color 0.2s ease;
    }

    #texto:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Campos de sele√ß√£o - SEGUNDO no layout */
    .story-selection-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    @media (max-width: 640px) {
      .story-selection-fields {
        grid-template-columns: 1fr;
      }
    }

    /* ===== NOVA SE√á√ÉO: PRAZO PARA REVIS√ÉO NA CRIA√á√ÉO ===== */
    .review-config-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
      background: rgba(59, 130, 246, 0.05);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: var(--radius);
      margin-bottom: 8px;
    }

    .review-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .review-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--primary);
    }

    .review-checkbox label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
      user-select: none;
    }

    .review-checkbox label:hover {
      color: var(--primary);
    }

    .review-fields {
      display: flex;
      gap: 12px;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .review-fields.hidden {
      display: none;
    }

    /* Estilos espec√≠ficos para o datepicker na cria√ß√£o */
    .review-config-section .datepicker-container {
      max-width: 220px;
    }

    .review-config-section #reviewDate {
      flex: 1;
      min-width: 140px;
      padding: 8px 10px;
      font-size: 14px;
      height: 38px;
      border: 1px solid var(--border);
      border-radius: 5px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      text-align: left;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .review-config-section #reviewDate:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
    }

    .review-config-section #reviewDate:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .review-config-section .calendar-toggle-btn {
      height: 38px;
      width: 38px;
    }

    /* Calend√°rio para cria√ß√£o */
    .calendar-modal.create {
      z-index: 1100;
    }

    .story-form-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    button {
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border: none;
      transition: all 0.2s ease;
      font-size: 14px;
      border-radius: 6px;
    }

    button.primary {
      background: var(--primary);
      color: white;
    }

    button.primary:hover {
      background: var(--primary-hover);
      box-shadow: var(--shadow);
    }

    button.secondary {
      background: var(--border-light);
      color: var(--text);
    }

    button.secondary:hover {
      background: var(--border);
    }

    button.danger {
      background: var(--danger);
      color: white;
    }

    button.danger:hover {
      background: var(--danger-hover);
    }

    button.small {
      padding: 6px 12px;
      font-size: 12px;
    }

    button.full-width {
      width: 100%;
    }

    /* SE√á√ÉO: Visualiza√ß√£o dos Cards - MANTIDO IGUAL */
    .section-cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .cards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
    }

    .cards-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .cards-header h2::before {
      content: "üìã";
      font-size: 18px;
    }

    /* ===== FILTROS MODIFICADOS - COM FILTRO DE VENCIDAS ===== */
    .filters-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
      padding: 0;
    }

    .filter-group label {
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      font-size: 13px;
      min-width: auto;
    }

    #clienteSelectCards,
    #statusFilter {
      min-width: 150px;
      padding: 6px 10px;
      font-size: 13px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    #clienteSelectCards:hover,
    #statusFilter:hover {
      border-color: var(--primary);
    }

    #clienteSelectCards:focus,
    #statusFilter:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Bot√£o de filtro de vencidas - NOVO */
    .filter-vencidas-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
    }

    .filter-vencidas-btn:hover {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }

    .filter-vencidas-btn.active {
      background: rgba(239, 68, 68, 0.1);
      border-color: var(--danger);
      color: var(--danger);
      font-weight: 700;
    }

    .filter-vencidas-btn .badge {
      background: var(--filter-badge);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 1px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
      margin-left: 2px;
    }

    .cards-container {
      flex: 1;
      margin-top: 16px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    /* CARD MODIFICADO - Com badge de revis√£o */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-top: 4px solid var(--border);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .card[data-status="Resolvido"] {
      border-top-color: var(--success);
    }

    .card[data-status="Importante"] {
      border-top-color: var(--warning);
    }

    .card[data-status="Pendente"] {
      border-top-color: var(--danger);
    }

    .card[data-status="API"] {
      border-top-color: var(--api-color);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .card h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
      margin-right: 12px;
    }

    /* Status badge */
    .status {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      background: var(--border-light);
      white-space: nowrap;
    }

    .status[data-status="Resolvido"] {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status[data-status="Importante"] {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .status[data-status="Pendente"] {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .status[data-status="API"] {
      background: rgba(139, 92, 246, 0.1);
      color: var(--api-color);
    }

    /* Badge de revis√£o */
    .review-badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      margin-top: 4px;
      white-space: nowrap;
    }

    .review-badge.future {
      background: rgba(16, 185, 129, 0.1);
      color: var(--review-future);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .review-badge.today {
      background: rgba(245, 158, 11, 0.1);
      color: var(--review-today);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .review-badge.overdue {
      background: rgba(239, 68, 68, 0.1);
      color: var(--review-today);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    /* Informa√ß√µes de data */
    .card-dates {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
      padding: 10px;
      background: var(--border-light);
      border-radius: 6px;
      font-size: 12px;
    }

    .date-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-light);
    }

    .date-info .label {
      font-weight: 600;
      color: var(--text);
      min-width: 70px;
    }

    .date-info .value {
      flex: 1;
    }

    /* A√ß√µes do card */
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    /* Lista de clientes e equipes */
    .clients-list,
    .teams-list {
      margin-top: 20px;
      border-top: 1px solid var(--border-light);
      padding-top: 20px;
    }

    .clients-list h3,
    .teams-list h3 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
    }

    .client-item,
    .team-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: var(--border-light);
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .client-item-actions,
    .team-item-actions {
      display: flex;
      gap: 8px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: var(--text);
    }

    .empty-state p {
      max-width: 400px;
      margin: 0 auto;
      font-size: 14px;
    }

    /* Op√ß√µes de gerenciamento de dados */
    .data-options {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
    }

    .data-option {
      padding: 16px;
      background: var(--border-light);
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .data-option h3 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .data-option p {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 12px;
    }

    /* ===== MODAL DE EDI√á√ÉO - CABE√áALHO COMPACTO ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    .modal-box {
      background: var(--card);
      border-radius: var(--radius);
      width: 90%;
      height: 90%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      animation: modalSlideUp 0.3s ease;
    }

    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* CABE√áALHO DO MODAL - COMPACTO */
    .modal-header {
      padding: 12px 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
      flex-shrink: 0;
      min-height: 56px;
    }

    .modal-header-content {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
      min-width: 0;
    }

    .modal-title-container {
      flex: 1;
      min-width: 0;
    }

    .modal-title-input {
      width: 100%;
      padding: 8px 12px;
      font-size: 15px;
      font-weight: 600;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      transition: all 0.2s ease;
      min-height: 38px;
    }

    .modal-title-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .modal-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .modal-status-select {
      min-width: 140px;
      padding: 6px 10px;
      font-size: 13px;
      height: 34px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-status-select:hover {
      border-color: var(--primary);
    }

    .modal-status-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .modal-review-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text);
      border: 1px solid rgba(59, 130, 246, 0.1);
      white-space: nowrap;
      height: 34px;
    }

    .modal-review-date {
      font-weight: 600;
      color: var(--primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 22px;
      color: var(--text-light);
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .modal-close:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text);
    }

    .modal-body {
      padding: 16px 20px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* ===== FORMUL√ÅRIO SUPERIOR - COMPACTO ===== */
    .modal-top-form {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      background: var(--border-light);
      border-radius: var(--radius);
      margin-bottom: 16px;
      flex-wrap: wrap;
      border: 1px solid var(--border);
    }

    .modal-top-form .form-group {
      flex: 1;
      min-width: 160px;
      margin-bottom: 0;
    }

    .modal-top-form .form-group:first-child {
      flex: 2;
      min-width: 200px;
    }

    .modal-top-form label {
      display: block;
      margin-bottom: 4px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-top-form input,
    .modal-top-form select {
      width: 100%;
      padding: 8px 10px;
      font-size: 13px;
      height: 36px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 5px;
      transition: all 0.2s ease;
    }

    .modal-top-form input:focus,
    .modal-top-form select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .modal-top-form input:hover,
    .modal-top-form select:hover {
      border-color: var(--primary-hover);
    }

    /* Configura√ß√£o de prazo de revis√£o - COMPACTO */
    .review-config-compact {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
      padding: 12px;
      background: rgba(59, 130, 246, 0.05);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: var(--radius);
      width: 100%;
    }

    .review-checkbox-compact {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .review-checkbox-compact input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: var(--primary);
    }

    .review-checkbox-compact label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
      white-space: nowrap;
      user-select: none;
    }

    .review-checkbox-compact label:hover {
      color: var(--primary);
    }

    .review-fields-compact {
      display: flex;
      gap: 8px;
      align-items: center;
      animation: fadeIn 0.3s ease;
      flex: 1;
      min-width: 180px;
    }

    .review-fields-compact.hidden {
      display: none;
    }

    /* ===== ESTILOS DO NOVO CALEND√ÅRIO ===== */
    .datepicker-container {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 180px;
    }

    .date-input-wrapper {
      display: flex;
      gap: 6px;
      align-items: center;
      width: 100%;
    }

    #editReviewDate,
    #reviewDate {
      flex: 1;
      min-width: 120px;
      padding: 6px 8px;
      font-size: 13px;
      height: 34px;
      border: 1px solid var(--border);
      border-radius: 5px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      text-align: left;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    #editReviewDate:hover,
    #reviewDate:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
    }

    #editReviewDate:focus,
    #reviewDate:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .calendar-toggle-btn {
      background: var(--primary);
      border: none;
      color: white;
      cursor: pointer;
      padding: 8px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      height: 34px;
      width: 34px;
      flex-shrink: 0;
    }

    .calendar-toggle-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
    }

    .calendar-toggle-btn:active {
      transform: translateY(0);
    }

    .calendar-modal {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 8px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      width: 280px;
      padding: 12px;
      display: none;
      animation: fadeIn 0.2s ease;
    }

    .calendar-modal.active {
      display: block;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-month-year {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }

    .calendar-nav-btn {
      background: none;
      border: none;
      color: var(--text);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .calendar-nav-btn:hover {
      background: var(--border-light);
      color: var(--primary);
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
      text-align: center;
    }

    .calendar-weekday {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-light);
      padding: 6px 4px;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }

    .calendar-day {
      padding: 8px;
      font-size: 12px;
      text-align: center;
      border: none;
      background: none;
      color: var(--text);
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s ease;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-day:hover {
      background: var(--border-light);
    }

    .calendar-day.today {
      background: rgba(59, 130, 246, 0.15);
      color: var(--primary);
      font-weight: 600;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .calendar-day.selected {
      background: var(--primary);
      color: white;
      font-weight: 600;
    }

    .calendar-day.other-month {
      color: var(--text-light);
      opacity: 0.5;
    }

    .calendar-day.disabled {
      color: var(--text-light);
      opacity: 0.3;
      cursor: not-allowed;
      background: none;
    }

    .calendar-day.disabled:hover {
      background: none;
    }

    .calendar-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-light);
    }

    .calendar-today-btn {
      background: var(--border-light);
      color: var(--text);
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .calendar-today-btn:hover {
      background: var(--border);
    }

    .calendar-clear-btn {
      background: none;
      color: var(--danger);
      border: 1px solid var(--danger);
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .calendar-clear-btn:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    .modal-footer {
      padding: 12px 20px;
      border-top: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
      flex-shrink: 0;
      min-height: 56px;
    }

    .client-info {
      color: var(--text-light);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .client-info strong {
      color: var(--text);
      font-weight: 600;
    }

    .modal-footer-actions {
      display: flex;
      gap: 8px;
    }

    .modal-footer-actions button {
      padding: 8px 16px;
      font-size: 13px;
      border-radius: 6px;
      font-weight: 600;
    }

    /* ===== SE√á√ÉO DE ANOTA√á√ïES - ABAIXO DO FORMUL√ÅRIO ===== */
    .modal-notes-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .modal-notes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .modal-notes-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .modal-notes-title::before {
      content: "üìù";
      font-size: 13px;
    }

    .add-note-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
    }

    .add-note-btn:hover {
      background: var(--primary-hover);
    }

    .notes-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      min-height: 0;
    }

    .note-item {
      background: var(--note-bg);
      border: 1px solid var(--note-border);
      border-radius: 6px;
      padding: 12px;
      position: relative;
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px dashed var(--border);
    }

    .note-date {
      font-size: 11px;
      color: var(--text-light);
      font-weight: 500;
    }

    .note-expand-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--expand-color);
      font-size: 14px;
      font-weight: bold;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .note-expand-btn:hover {
      background: rgba(59, 130, 246, 0.1);
    }

    .note-content {
      font-size: 13px;
      line-height: 1.5;
      color: var(--text);
      max-height: 60px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .note-content.expanded {
      max-height: 500px;
      overflow-y: auto;
    }

    .note-content-placeholder {
      color: var(--text-light);
      font-style: italic;
      font-size: 12px;
      padding: 6px;
    }

    .note-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      justify-content: flex-end;
    }

    .note-actions button {
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 4px;
    }

    .note-edit-input {
      width: 100%;
      min-height: 100px;
      padding: 10px;
      font-family: inherit;
      font-size: 13px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      resize: vertical;
      margin-bottom: 8px;
    }

    .note-edit-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* ===== CLASSE HIDDEN PARA ELEMENTOS OCULTOS ===== */
    .hidden {
      display: none !important;
    }

    /* Responsividade para o modal */
    @media (max-width: 1024px) {
      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        justify-content: flex-start;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 140px;
      }

      .modal-box {
        width: 95%;
        height: 95%;
      }

      .modal-top-form {
        gap: 12px;
      }

      .modal-top-form .form-group,
      .modal-top-form .form-group:first-child {
        min-width: calc(50% - 8px);
      }

      .review-config-compact {
        min-width: 100%;
        margin-top: 8px;
      }

      .review-config-section {
        flex-direction: column;
      }

      .review-config-section .datepicker-container {
        max-width: 100%;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }

      .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .filter-group {
        width: 100%;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 100%;
        width: 100%;
      }

      .filter-vencidas-btn {
        width: 100%;
        justify-content: center;
      }

      .modal-header {
        padding: 10px 16px;
        min-height: 52px;
      }

      .modal-body {
        padding: 12px 16px;
        gap: 12px;
      }

      .modal-footer {
        padding: 10px 16px;
        min-height: 52px;
      }

      .modal-box {
        width: 98%;
        height: 98%;
      }

      .modal-header-content {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .modal-title-container {
        width: 100%;
      }

      .modal-header-right {
        width: 100%;
        justify-content: space-between;
      }

      .modal-status-select {
        min-width: 120px;
      }

      .modal-review-info {
        font-size: 11px;
        padding: 5px 8px;
      }

      .modal-top-form {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        padding: 12px;
      }

      .modal-top-form .form-group,
      .modal-top-form .form-group:first-child {
        min-width: 100%;
        width: 100%;
      }

      .review-config-compact {
        width: 100%;
        justify-content: space-between;
        padding: 10px;
        gap: 10px;
      }

      .review-config-section {
        padding: 12px;
      }

      .review-fields {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        width: 100%;
      }

      .review-config-section .datepicker-container {
        max-width: 100%;
      }

      .menu-sidebar {
        width: 280px;
      }

      .menu-item {
        padding: 12px 16px;
      }

      .card-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .card h3 {
        margin-right: 0;
      }

      .status {
        align-self: flex-start;
      }

      .modal-notes-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .add-note-btn {
        align-self: flex-end;
      }

      .review-fields-compact {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        width: 100%;
      }

      .calendar-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 300px;
        margin-top: 0;
      }

      .calendar-days {
        gap: 2px;
      }

      .calendar-day {
        padding: 6px;
        min-height: 30px;
      }
    }

    @media (max-width: 640px) {
      .cards-grid {
        grid-template-columns: 1fr;
      }

      .menu-sidebar {
        width: 260px;
      }

      .header-left {
        gap: 12px;
      }

      .header h1 {
        font-size: 20px;
      }

      .cards-header h2 {
        font-size: 18px;
      }

      .filter-group label {
        font-size: 12px;
      }

      #clienteSelectCards,
      #statusFilter {
        font-size: 12px;
        padding: 6px 8px;
        height: 30px;
      }

      .modal-header {
        padding: 8px 12px;
        min-height: 48px;
      }

      .modal-title-input {
        font-size: 14px;
        padding: 6px 8px;
        min-height: 34px;
      }

      .modal-status-select {
        height: 32px;
        font-size: 12px;
        min-width: 100px;
      }

      .modal-review-info {
        height: 32px;
        font-size: 10px;
      }

      .modal-footer {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        padding: 8px 12px;
      }

      .client-info {
        justify-content: center;
        text-align: center;
        font-size: 11px;
      }

      .modal-footer-actions {
        justify-content: center;
      }

      .modal-footer-actions button {
        padding: 6px 12px;
        font-size: 12px;
      }

      .note-item {
        padding: 10px;
      }

      .note-edit-input {
        min-height: 80px;
      }

      .card-dates {
        padding: 8px;
      }

      .date-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
      }

      .date-info .label {
        min-width: auto;
        font-size: 11px;
      }

      .review-config-compact {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .review-checkbox-compact {
        width: 100%;
      }

      .review-fields-compact {
        min-width: 160px;
        width: 100%;
      }

      .datepicker-container {
        max-width: 100%;
      }

      #editReviewDate,
      #reviewDate {
        min-width: 120px;
        font-size: 12px;
        height: 32px;
      }

      .calendar-toggle-btn {
        width: 32px;
        height: 32px;
        padding: 7px;
      }

      .review-config-section #reviewDate {
        min-width: 120px;
        font-size: 12px;
        height: 32px;
      }

      .review-config-section .calendar-toggle-btn {
        width: 32px;
        height: 32px;
        padding: 7px;
      }
    }

    @media (max-width: 480px) {
      .modal-header {
        min-height: 44px;
      }

      .modal-title-input {
        font-size: 13px;
        min-height: 32px;
      }

      .modal-header-right {
        flex-wrap: wrap;
        gap: 6px;
      }

      .modal-status-select {
        min-width: 90px;
        height: 30px;
      }

      .modal-review-info {
        padding: 4px 6px;
        height: 30px;
      }

      .review-config-compact {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        padding: 8px;
      }

      .review-config-section {
        padding: 10px;
        gap: 10px;
      }

      .datepicker-container {
        max-width: 100%;
      }

      #editReviewDate,
      #reviewDate {
        min-width: 100px;
        font-size: 12px;
        padding: 5px 6px;
      }

      .calendar-toggle-btn {
        width: 30px;
        height: 30px;
        padding: 6px;
      }

      .modal-close {
        width: 28px;
        height: 28px;
        font-size: 20px;
      }

      .review-config-section #reviewDate {
        min-width: 100px;
        font-size: 12px;
        padding: 5px 6px;
      }

      .review-config-section .calendar-toggle-btn {
        width: 30px;
        height: 30px;
        padding: 6px;
      }
    }

    @media (max-width: 1024px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
    }
  </style>
</head>

<body>

  <!-- Menu Hamb√∫rguer Overlay -->
  <div class="menu-overlay" id="menuOverlay"></div>

  <!-- Menu Lateral -->
  <div class="menu-sidebar" id="menuSidebar">
    <div class="menu-header">
      <h2>Menu</h2>
      <button class="menu-close" id="menuClose">√ó</button>
    </div>
    <div class="menu-items">
      <div class="menu-item active" data-section="historias-salvas">
        <span class="menu-item-icon">üìã</span>
        <span>Hist√≥rias Salvas</span>
      </div>
      <div class="menu-item" data-section="criar-historia">
        <span class="menu-item-icon">‚úèÔ∏è</span>
        <span>Criar Nova Hist√≥ria</span>
      </div>
      <div class="menu-item" data-section="adicionar-cliente">
        <span class="menu-item-icon">üë•</span>
        <span>Adicionar Pessoas</span>
      </div>
      <div class="menu-item" data-section="gerenciar-dados">
        <span class="menu-item-icon">üíæ</span>
        <span>Gerenciar Dados</span>
      </div>
      <div class="menu-item" id="themeToggle">
        <span class="menu-item-icon" id="themeIcon">üåô</span>
        <span id="themeText">Tema Claro</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <h1>Hist√≥rias por Cliente</h1>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Hist√≥rias Salvas (vis√≠vel por padr√£o) - COM FILTRO DE VENCIDAS -->
    <div class="main-content active" id="historias-salvas">
      <div class="section-cards">
        <div class="cards-header">
          <h2>Hist√≥rias Salvas</h2>

          <!-- Filtros agora ao lado do t√≠tulo - COM BOT√ÉO DE VENCIDAS -->
          <div class="filters-container">
            <div class="filter-group">
              <label for="clienteSelectCards">Cliente:</label>
              <select id="clienteSelectCards" onchange="renderCards()">
                <option value="">Todos</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="statusFilter">Status:</label>
              <select id="statusFilter" onchange="renderCards()">
                <option value="">Todos</option>
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>

            <!-- Bot√£o para mostrar apenas hist√≥rias vencidas - NOVO -->
            <div class="filter-vencidas-btn" id="filterVencidasBtn" onclick="toggleFiltroVencidas()">
              <span>‚ö†Ô∏è Mostrar Vencidas</span>
              <span class="badge" id="vencidasCount">0</span>
            </div>
          </div>
        </div>

        <div class="cards-container">
          <div class="cards-grid" id="cards">
            <!-- Cards ser√£o renderizados aqui -->
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Criar Nova Hist√≥ria - LAYOUT SIMPLIFICADO -->
    <div class="main-content" id="criar-historia">
      <div class="section-creation">
        <h2 class="section-title">Criar Nova Hist√≥ria</h2>

        <!-- Formul√°rio de Criar Hist√≥rias - ORDEM ALTERADA -->
        <div class="story-creation">
          <!-- 1. √Årea de texto grande (PRIMEIRO) -->
          <div class="story-textarea-container">
            <label for="texto">Detalhes da Hist√≥ria</label>
            <textarea id="texto" placeholder="Digite os detalhes da hist√≥ria aqui..."></textarea>
          </div>

          <!-- 2. Campos de sele√ß√£o (SEGUNDO) -->
          <div class="story-selection-fields">
            <div class="form-group">
              <label for="clienteSelect">Cliente</label>
              <select id="clienteSelect">
                <option value="">Selecione um cliente</option>
              </select>
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <select id="status">
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>
          </div>

          <!-- 3. T√≠tulo (TERCEIRO) -->
          <div class="form-group">
            <label for="titulo">T√≠tulo da Hist√≥ria</label>
            <input id="titulo" placeholder="Digite um t√≠tulo para a hist√≥ria">
          </div>

          <!-- 4. Prazo para Revis√£o (QUARTO) - NOVO -->
          <div class="review-config-section">
            <div class="review-checkbox">
              <input type="checkbox" id="reviewCheckbox" onchange="toggleReviewSection()">
              <label for="reviewCheckbox">Definir Prazo para Revis√£o</label>
            </div>

            <div class="review-fields hidden" id="reviewFieldsCreate">
              <div class="datepicker-container">
                <input type="text" id="reviewDate" readonly onclick="toggleCalendar('create')" placeholder="Selecione uma data">
                <button class="calendar-toggle-btn" onclick="toggleCalendar('create')" type="button" title="Abrir calend√°rio">
                  üìÖ
                </button>

                <!-- Calend√°rio para cria√ß√£o -->
                <div class="calendar-modal create" id="calendarModalCreate">
                  <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="changeMonth('create', -1)" title="M√™s anterior">‚Äπ</button>
                    <div class="calendar-month-year" id="calendarMonthYearCreate"></div>
                    <button class="calendar-nav-btn" onclick="changeMonth('create', 1)" title="Pr√≥ximo m√™s">‚Ä∫</button>
                  </div>

                  <div class="calendar-weekdays">
                    <div class="calendar-weekday">Dom</div>
                    <div class="calendar-weekday">Seg</div>
                    <div class="calendar-weekday">Ter</div>
                    <div class="calendar-weekday">Qua</div>
                    <div class="calendar-weekday">Qui</div>
                    <div class="calendar-weekday">Sex</div>
                    <div class="calendar-weekday">S√°b</div>
                  </div>

                  <div class="calendar-days" id="calendarDaysCreate"></div>

                  <div class="calendar-footer">
                    <button class="calendar-today-btn" onclick="selectToday('create')">Hoje</button>
                    <button class="calendar-clear-btn" onclick="clearDate('create')">Limpar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 5. A√ß√µes -->
          <div class="story-form-actions">
            <button class="primary full-width" onclick="addCard()">Salvar Hist√≥ria</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Adicionar Pessoas - COM EDI√á√ÉO/EXCLUS√ÉO -->
    <div class="main-content" id="adicionar-cliente">
      <div class="section-add-client">
        <h2 class="section-title">Adicionar Pessoas</h2>

        <!-- Abas de sele√ß√£o -->
        <div class="tabs">
          <button class="tab-btn active" id="tabCliente" onclick="switchTab('cliente')">
            üë§ Cliente
          </button>
          <button class="tab-btn" id="tabEquipe" onclick="switchTab('equipe')">
            üë• Equipe
          </button>
        </div>

        <!-- Conte√∫do da aba Cliente -->
        <div class="tab-content active" id="contentCliente">
          <!-- Formul√°rio de Adicionar Cliente -->
          <div class="client-form">
            <div class="form-group">
              <label for="clienteNome">Nome do Cliente</label>
              <div style="display: flex; gap: 12px;">
                <input id="clienteNome" placeholder="Digite o nome do cliente">
                <button class="primary" onclick="addCliente()" style="white-space: nowrap;">Adicionar Cliente</button>
              </div>
            </div>

            <!-- Lista de clientes cadastrados -->
            <div class="clients-list" id="clientsList">
              <h3>Clientes Cadastrados</h3>
              <!-- Clientes ser√£o listados aqui -->
            </div>
          </div>
        </div>

        <!-- Conte√∫do da aba Equipe -->
        <div class="tab-content" id="contentEquipe">
          <!-- Formul√°rio de Adicionar Equipe -->
          <div class="team-form">
            <div class="form-group">
              <label for="equipeNome">Nome da Equipe</label>
              <div style="display: flex; gap: 12px;">
                <input id="equipeNome" placeholder="Digite o nome da equipe">
                <button class="primary" onclick="addEquipe()" style="white-space: nowrap;">Adicionar Equipe</button>
              </div>
            </div>

            <!-- Lista de equipes cadastradas -->
            <div class="teams-list" id="teamsList">
              <h3>Equipes Cadastradas</h3>
              <!-- Equipes ser√£o listadas aqui -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Gerenciar Dados - LAYOUT SIMPLIFICADO -->
    <div class="main-content" id="gerenciar-dados">
      <div class="section-data-management">
        <h2 class="section-title">Gerenciar Dados</h2>

        <!-- Op√ß√µes de gerenciamento -->
        <div class="data-options">
          <div class="data-option">
            <h3>üì• Exportar Dados</h3>
            <p>Exporta todos os dados (clientes, hist√≥rias, cards e anota√ß√µes) para um arquivo JSON.</p>
            <button class="primary full-width" onclick="exportarDados()">Exportar para JSON</button>
          </div>

          <div class="data-option">
            <h3>üì§ Importar Dados</h3>
            <p>Importa dados de um arquivo JSON. Substituir√° todos os dados atuais.</p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <input type="file" id="jsonFile" accept=".json" style="padding: 8px; font-size: 14px;">
              <button class="secondary full-width" onclick="importarDados()">Importar do JSON</button>
            </div>
          </div>

          <div class="data-option">
            <h3>üóëÔ∏è Excluir Todos os Dados</h3>
            <p style="color: var(--danger);">ATEN√á√ÉO: Esta a√ß√£o excluir√° permanentemente todos os clientes, hist√≥rias, cards e anota√ß√µes. N√£o √© poss√≠vel desfazer.</p>
            <button class="danger full-width" onclick="excluirTodosDados()">Excluir Todos os Dados</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE HIST√ìRIA - LAYOUT MINIMALISTA MODIFICADO -->
    <div class="modal" id="modal">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Editar Hist√≥ria</h2>
          <button class="modal-close" onclick="fecharModal()">√ó</button>
        </div>

        <div class="modal-body">
          <!-- FORMUL√ÅRIO SUPERIOR - UMA LINHA (T√çTULO, STATUS, PRAZO) -->
          <div class="modal-top-form">
            <!-- T√≠tulo -->
            <div class="form-group">
              <label for="editTitulo">T√≠tulo</label>
              <input id="editTitulo" placeholder="Digite o t√≠tulo da hist√≥ria">
            </div>

            <!-- Status -->
            <div class="form-group">
              <label for="editStatus">Status</label>
              <select id="editStatus">
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>

            <!-- Prazo de Revis√£o - MODIFICADO COM CALEND√ÅRIO -->
            <div class="review-config-compact">
              <div class="review-checkbox-compact">
                <input type="checkbox" id="editReviewCheckbox" onchange="toggleReviewFields()">
                <label for="editReviewCheckbox">Prazo de Revis√£o</label>
              </div>

              <div class="review-fields-compact hidden" id="reviewFieldsEdit">
                <div class="datepicker-container">
                  <input type="text" id="editReviewDate" readonly onclick="toggleCalendar('edit')" placeholder="Selecione uma data">
                  <button class="calendar-toggle-btn" onclick="toggleCalendar('edit')" type="button" title="Abrir calend√°rio">
                    üìÖ
                  </button>

                  <!-- Calend√°rio Minimalista -->
                  <div class="calendar-modal edit" id="calendarModalEdit">
                    <div class="calendar-header">
                      <button class="calendar-nav-btn" onclick="changeMonth('edit', -1)" title="M√™s anterior">‚Äπ</button>
                      <div class="calendar-month-year" id="calendarMonthYearEdit"></div>
                      <button class="calendar-nav-btn" onclick="changeMonth('edit', 1)" title="Pr√≥ximo m√™s">‚Ä∫</button>
                    </div>

                    <div class="calendar-weekdays">
                      <div class="calendar-weekday">Dom</div>
                      <div class="calendar-weekday">Seg</div>
                      <div class="calendar-weekday">Ter</div>
                      <div class="calendar-weekday">Qua</div>
                      <div class="calendar-weekday">Qui</div>
                      <div class="calendar-weekday">Sex</div>
                      <div class="calendar-weekday">S√°b</div>
                    </div>

                    <div class="calendar-days" id="calendarDaysEdit"></div>

                    <div class="calendar-footer">
                      <button class="calendar-today-btn" onclick="selectToday('edit')">Hoje</button>
                      <button class="calendar-clear-btn" onclick="clearDate('edit')">Limpar</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- SE√á√ÉO DE ANOTA√á√ïES - ABAIXO DO FORMUL√ÅRIO -->
          <div class="modal-notes-section" id="notesSection">
            <div class="modal-notes-header">
              <h3 class="modal-notes-title">Anota√ß√µes da Hist√≥ria</h3>
              <button class="add-note-btn" onclick="adicionarNovaAnotacao()">
                <span>+</span>
                <span>Nova Anota√ß√£o</span>
              </button>
            </div>

            <div class="notes-container" id="notesContainer">
              <!-- Anota√ß√µes ser√£o renderizadas aqui -->
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="client-info">
            <span>Editando hist√≥ria de:</span>
            <strong id="currentClienteName"></strong>
          </div>

          <div class="modal-footer-actions">
            <button class="secondary" onclick="fecharModal()">Cancelar</button>
            <button class="primary" onclick="salvarEdicao()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE CLIENTE -->
    <div class="modal" id="modalCliente">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Editar Cliente</h2>
          <button class="modal-close" onclick="fecharModalCliente()">√ó</button>
        </div>

        <div class="modal-body">
          <div class="modal-form">
            <div class="form-group">
              <label for="editClienteNome">Nome do Cliente</label>
              <input id="editClienteNome" placeholder="Digite o nome do cliente">
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="modal-footer-actions">
            <button class="secondary" onclick="fecharModalCliente()">Cancelar</button>
            <button class="primary" onclick="salvarEdicaoCliente()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE EQUIPE -->
    <div class="modal" id="modalEquipe">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Editar Equipe</h2>
          <button class="modal-close" onclick="fecharModalEquipe()">√ó</button>
        </div>

        <div class="modal-body">
          <div class="modal-form">
            <div class="form-group">
              <label for="editEquipeNome">Nome da Equipe</label>
              <input id="editEquipeNome" placeholder="Digite o nome da equipe">
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="modal-footer-actions">
            <button class="secondary" onclick="fecharModalEquipe()">Cancelar</button>
            <button class="primary" onclick="salvarEdicaoEquipe()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let dados = JSON.parse(localStorage.getItem("clientes")) || {};
      let dadosEquipes = JSON.parse(localStorage.getItem("equipes")) || {};
      let editCliente = null;
      let editIndex = null;
      let editClienteNome = null;
      let editEquipeNome = null;
      let filtroVencidasAtivo = false; // Estado do filtro de vencidas

      // ===== VARI√ÅVEIS DO CALEND√ÅRIO =====
      let currentCalendarDate = new Date();
      let selectedDate = null;
      let selectedDateCreate = null; // Data selecionada na cria√ß√£o
      let calendarVisible = false;
      let calendarContext = 'edit'; // 'edit' ou 'create'

      // Inicializa√ß√£o
      document.addEventListener('DOMContentLoaded', function () {
        // Configurar tema
        const isDark = localStorage.getItem("dark") === "true" ||
          (localStorage.getItem("dark") === null && window.matchMedia('(prefers-color-scheme: dark)').matches);

        if (isDark) {
          document.body.classList.add("dark");
        }
        atualizarTemaIcone(isDark);

        // Configurar menu
        setupMenu();

        // Configurar eventos
        setupModalEvents();

        // Inicializar dados
        atualizarSelects();
        atualizarContadorVencidas(); // Atualizar contador
        renderCards();
        renderClientesList();
        renderEquipesList();
      });

      // Configurar menu hamb√∫rguer
      function setupMenu() {
        const menuToggle = document.getElementById('menuToggle');
        const menuClose = document.getElementById('menuClose');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuSidebar = document.getElementById('menuSidebar');
        const menuItems = document.querySelectorAll('.menu-item');
        const sections = document.querySelectorAll('.main-content');
        const themeToggle = document.getElementById('themeToggle');

        // Abrir menu
        menuToggle.addEventListener('click', function () {
          menuSidebar.classList.add('active');
          menuOverlay.classList.add('active');
          menuToggle.classList.add('active');
        });

        // Fechar menu
        function closeMenu() {
          menuSidebar.classList.remove('active');
          menuOverlay.classList.remove('active');
          menuToggle.classList.remove('active');
        }

        menuClose.addEventListener('click', closeMenu);
        menuOverlay.addEventListener('click', closeMenu);

        // Alternar tema
        themeToggle.addEventListener('click', function () {
          toggleDark();
          closeMenu();
        });

        // Navegar entre se√ß√µes
        menuItems.forEach(item => {
          if (item === themeToggle) return; // Pular o bot√£o de tema

          item.addEventListener('click', function () {
            const sectionId = this.dataset.section;

            // Atualizar item ativo no menu
            menuItems.forEach(i => {
              if (i.dataset.section) {
                i.classList.remove('active');
              }
            });
            this.classList.add('active');

            // Mostrar se√ß√£o correspondente
            sections.forEach(section => {
              section.classList.remove('active');
              if (section.id === sectionId) {
                section.classList.add('active');
              }
            });

            // Fechar menu
            closeMenu();
          });
        });
      }

      function setupModalEvents() {
        // Fechar com ESC
        document.addEventListener('keydown', function (event) {
          if (event.key === 'Escape') {
            if (document.getElementById('modal').classList.contains('active')) {
              fecharModal();
            }
            if (document.getElementById('modalCliente').classList.contains('active')) {
              fecharModalCliente();
            }
            if (document.getElementById('modalEquipe').classList.contains('active')) {
              fecharModalEquipe();
            }
            if (calendarVisible) {
              closeCalendar();
            }
          }
        });
      }

      // Fun√ß√£o para alternar entre abas
      function switchTab(tab) {
        // Atualizar bot√µes das abas
        document.getElementById('tabCliente').classList.remove('active');
        document.getElementById('tabEquipe').classList.remove('active');

        // Ocultar todos os conte√∫dos
        document.getElementById('contentCliente').classList.remove('active');
        document.getElementById('contentEquipe').classList.remove('active');

        // Ativar aba selecionada
        if (tab === 'cliente') {
          document.getElementById('tabCliente').classList.add('active');
          document.getElementById('contentCliente').classList.add('active');
        } else if (tab === 'equipe') {
          document.getElementById('tabEquipe').classList.add('active');
          document.getElementById('contentEquipe').classList.add('active');
        }
      }

      function salvar() {
        localStorage.setItem("clientes", JSON.stringify(dados));
        localStorage.setItem("equipes", JSON.stringify(dadosEquipes));
        atualizarContadorVencidas(); // Atualizar contador ap√≥s salvar
      }

      function toggleDark() {
        const body = document.body;
        body.classList.toggle("dark");
        const isDark = body.classList.contains("dark");
        localStorage.setItem("dark", isDark);
        atualizarTemaIcone(isDark);
      }

      function atualizarTemaIcone(isDark) {
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');

        if (isDark) {
          themeIcon.textContent = '‚òÄÔ∏è';
          themeText.textContent = 'Tema Claro';
        } else {
          themeIcon.textContent = 'üåô';
          themeText.textContent = 'Tema Escuro';
        }
      }

      function atualizarSelects() {
        // Atualizar select da se√ß√£o de cria√ß√£o
        const selectCriacao = document.getElementById('clienteSelect');
        selectCriacao.innerHTML = '<option value="">Selecione um cliente</option>';

        // Atualizar select da se√ß√£o de cards (filtro por cliente)
        const selectClienteCards = document.getElementById('clienteSelectCards');
        selectClienteCards.innerHTML = '<option value="">Todos</option>';

        Object.keys(dados).sort().forEach(cliente => {
          // Para select de cria√ß√£o
          const option1 = document.createElement('option');
          option1.value = cliente;
          option1.textContent = cliente;
          selectCriacao.appendChild(option1);

          // Para select de visualiza√ß√£o (filtro por cliente)
          const option2 = document.createElement('option');
          option2.value = cliente;
          option2.textContent = cliente;
          selectClienteCards.appendChild(option2);
        });
      }

      // Fun√ß√£o para contar hist√≥rias vencidas
      function contarHistoriasVencidas() {
        let contador = 0;
        const hoje = new Date();

        Object.keys(dados).forEach(cliente => {
          dados[cliente].forEach(historia => {
            if (historia.prazoRevisao && historia.dataConfiguracaoRevisao) {
              const dataConfiguracao = new Date(historia.dataConfiguracaoRevisao);
              const dataVencimento = new Date(dataConfiguracao);
              dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

              const diffTime = dataVencimento - hoje;
              const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

              // Contar apenas hist√≥rias vencidas (dias negativos)
              if (diffDays < 0) {
                contador++;
              }
            }
          });
        });

        return contador;
      }

      // Atualizar contador de vencidas no bot√£o
      function atualizarContadorVencidas() {
        const contador = contarHistoriasVencidas();
        const badgeElement = document.getElementById('vencidasCount');
        const botaoElement = document.getElementById('filterVencidasBtn');

        badgeElement.textContent = contador;

        // Mostrar/esconder badge se n√£o h√° vencidas
        if (contador === 0) {
          badgeElement.style.display = 'none';
          // Se n√£o h√° vencidas e o filtro est√° ativo, desativ√°-lo
          if (filtroVencidasAtivo) {
            filtroVencidasAtivo = false;
            botaoElement.classList.remove('active');
          }
        } else {
          badgeElement.style.display = 'inline-flex';
        }
      }

      // Alternar filtro de vencidas
      function toggleFiltroVencidas() {
        const botaoElement = document.getElementById('filterVencidasBtn');
        filtroVencidasAtivo = !filtroVencidasAtivo;

        if (filtroVencidasAtivo) {
          botaoElement.classList.add('active');
          // Alterar texto quando ativo
          botaoElement.innerHTML = '<span>‚ö†Ô∏è Mostrando Vencidas</span><span class="badge" id="vencidasCount">' + document.getElementById('vencidasCount').textContent + '</span>';
        } else {
          botaoElement.classList.remove('active');
          // Voltar texto original
          botaoElement.innerHTML = '<span>‚ö†Ô∏è Mostrar Vencidas</span><span class="badge" id="vencidasCount">' + document.getElementById('vencidasCount').textContent + '</span>';
        }

        renderCards(); // Re-renderizar os cards com o filtro aplicado
      }

      // Verificar se uma hist√≥ria est√° vencida
      function historiaEstaVencida(historia) {
        if (!historia.prazoRevisao || !historia.dataConfiguracaoRevisao) {
          return false;
        }

        const hoje = new Date();
        const dataConfiguracao = new Date(historia.dataConfiguracaoRevisao);
        const dataVencimento = new Date(dataConfiguracao);
        dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

        const diffTime = dataVencimento - hoje;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        return diffDays < 0; // Vencida se dias negativos
      }

      function renderClientesList() {
        const container = document.getElementById('clientsList');
        const clientes = Object.keys(dados);

        if (clientes.length === 0) {
          container.innerHTML = `
          <h3>Clientes Cadastrados</h3>
          <div class="empty-state" style="padding: 20px; margin-top: 10px;">
            <p>Nenhum cliente cadastrado ainda.</p>
          </div>
        `;
          return;
        }

        let html = '<h3>Clientes Cadastrados</h3>';

        clientes.sort().forEach(cliente => {
          const numHistorias = dados[cliente].length;
          html += `
          <div class="client-item">
            <span>${cliente} <small style="color: var(--text-light);">(${numHistorias} hist√≥rias)</small></span>
            <div class="client-item-actions">
              <button class="secondary small" onclick="editarCliente('${cliente}')">Editar</button>
              <button class="danger small" onclick="excluirCliente('${cliente}')">Excluir</button>
            </div>
          </div>
        `;
        });

        container.innerHTML = html;
      }

      function renderEquipesList() {
        const container = document.getElementById('teamsList');
        const equipes = Object.keys(dadosEquipes);

        if (equipes.length === 0) {
          container.innerHTML = `
          <h3>Equipes Cadastradas</h3>
          <div class="empty-state" style="padding: 20px; margin-top: 10px;">
            <p>Nenhuma equipe cadastrada ainda.</p>
          </div>
        `;
          return;
        }

        let html = '<h3>Equipes Cadastradas</h3>';

        equipes.sort().forEach(equipe => {
          const numMembros = dadosEquipes[equipe] ? dadosEquipes[equipe].length : 0;
          html += `
          <div class="team-item">
            <span>${equipe} <small style="color: var(--text-light);">(${numMembros} membros)</small></span>
            <div class="team-item-actions">
              <button class="secondary small" onclick="editarEquipe('${equipe}')">Editar</button>
              <button class="danger small" onclick="excluirEquipe('${equipe}')">Excluir</button>
            </div>
          </div>
        `;
        });

        container.innerHTML = html;
      }

      function addCliente() {
        const nomeInput = document.getElementById('clienteNome');
        const nome = nomeInput.value.trim();

        if (!nome) {
          alert('Por favor, digite um nome para o cliente.');
          nomeInput.focus();
          return;
        }

        if (dados[nome]) {
          alert('J√° existe um cliente com esse nome.');
          nomeInput.focus();
          return;
        }

        dados[nome] = [];
        salvar();
        atualizarSelects();
        renderClientesList();
        nomeInput.value = "";
        nomeInput.focus();
      }

      function addEquipe() {
        const nomeInput = document.getElementById('equipeNome');
        const nome = nomeInput.value.trim();

        if (!nome) {
          alert('Por favor, digite um nome para a equipe.');
          nomeInput.focus();
          return;
        }

        if (dadosEquipes[nome]) {
          alert('J√° existe uma equipe com esse nome.');
          nomeInput.focus();
          return;
        }

        dadosEquipes[nome] = [];
        salvar();
        renderEquipesList();
        nomeInput.value = "";
        nomeInput.focus();
      }

      function editarCliente(cliente) {
        editClienteNome = cliente;
        document.getElementById('editClienteNome').value = cliente;
        document.getElementById('modalCliente').classList.add('active');
        document.getElementById('editClienteNome').focus();
      }

      function editarEquipe(equipe) {
        editEquipeNome = equipe;
        document.getElementById('editEquipeNome').value = equipe;
        document.getElementById('modalEquipe').classList.add('active');
        document.getElementById('editEquipeNome').focus();
      }

      function fecharModalCliente() {
        document.getElementById('modalCliente').classList.remove('active');
        editClienteNome = null;
      }

      function fecharModalEquipe() {
        document.getElementById('modalEquipe').classList.remove('active');
        editEquipeNome = null;
      }

      function salvarEdicaoCliente() {
        const novoNome = document.getElementById('editClienteNome').value.trim();

        if (!novoNome) {
          alert('O nome do cliente n√£o pode estar vazio.');
          document.getElementById('editClienteNome').focus();
          return;
        }

        if (novoNome !== editClienteNome && dados[novoNome]) {
          alert('J√° existe um cliente com esse nome.');
          document.getElementById('editClienteNome').focus();
          return;
        }

        if (novoNome !== editClienteNome) {
          // Renomear o cliente
          dados[novoNome] = dados[editClienteNome];
          delete dados[editClienteNome];

          // Atualizar o nome do cliente em todas as hist√≥rias
          dados[novoNome].forEach(historia => {
            historia.cliente = novoNome;
          });
        }

        salvar();
        atualizarSelects();
        renderCards();
        renderClientesList();
        fecharModalCliente();
      }

      function salvarEdicaoEquipe() {
        const novoNome = document.getElementById('editEquipeNome').value.trim();

        if (!novoNome) {
          alert('O nome da equipe n√£o pode estar vazio.');
          document.getElementById('editEquipeNome').focus();
          return;
        }

        if (novoNome !== editEquipeNome && dadosEquipes[novoNome]) {
          alert('J√° existe uma equipe com esse nome.');
          document.getElementById('editEquipeNome').focus();
          return;
        }

        if (novoNome !== editEquipeNome) {
          // Renomear a equipe
          dadosEquipes[novoNome] = dadosEquipes[editEquipeNome];
          delete dadosEquipes[editEquipeNome];
        }

        salvar();
        renderEquipesList();
        fecharModalEquipe();
      }

      function excluirCliente(cliente) {
        if (dados[cliente].length > 0) {
          if (!confirm(`O cliente "${cliente}" tem ${dados[cliente].length} hist√≥rias. Tem certeza que deseja excluir o cliente e todas as suas hist√≥rias?`)) {
            return;
          }
        } else {
          if (!confirm(`Tem certeza que deseja excluir o cliente "${cliente}"?`)) {
            return;
          }
        }

        delete dados[cliente];
        salvar();
        atualizarSelects();
        renderCards();
        renderClientesList();
      }

      function excluirEquipe(equipe) {
        if (dadosEquipes[equipe].length > 0) {
          if (!confirm(`A equipe "${equipe}" tem ${dadosEquipes[equipe].length} membros. Tem certeza que deseja excluir a equipe?`)) {
            return;
          }
        } else {
          if (!confirm(`Tem certeza que deseja excluir a equipe "${equipe}"?`)) {
            return;
          }
        }

        delete dadosEquipes[equipe];
        salvar();
        renderEquipesList();
      }

      // Fun√ß√£o para converter data de YYYY-MM-DD para DD/MM/YYYY
      function formatarDataBrasileira(dataISO) {
        if (!dataISO) return '';
        const partes = dataISO.split('-');
        if (partes.length !== 3) return dataISO;
        return `${partes[2]}/${partes[1]}/${partes[0]}`;
      }

      // Fun√ß√£o para converter data de DD/MM/YYYY para YYYY-MM-DD
      function formatarDataISO(dataBrasileira) {
        if (!dataBrasileira) return '';
        const partes = dataBrasileira.split('/');
        if (partes.length !== 3) return dataBrasileira;
        return `${partes[2]}-${partes[1]}-${partes[0]}`;
      }

      // ===== NOVA FUN√á√ÉO: ALTERNAR SE√á√ÉO DE REVIS√ÉO NA CRIA√á√ÉO =====
      function toggleReviewSection() {
        const reviewCheckbox = document.getElementById('reviewCheckbox');
        const reviewFields = document.getElementById('reviewFieldsCreate'); // CORRIGIDO: Agora usa o ID correto

        if (reviewCheckbox.checked) {
          reviewFields.classList.remove('hidden');
          // Se n√£o houver data selecionada, sugerir 7 dias a partir de hoje
          if (!selectedDateCreate) {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 7);
            selectedDateCreate = futureDate;
            document.getElementById('reviewDate').value = formatDate(futureDate);
          }
        } else {
          reviewFields.classList.add('hidden');
          selectedDateCreate = null;
          document.getElementById('reviewDate').value = '';
        }
      }

      function addCard() {
        const cliente = document.getElementById('clienteSelect').value;
        if (!cliente) {
          alert('Selecione um cliente primeiro.');
          return;
        }

        const titulo = document.getElementById('titulo').value.trim();
        const texto = document.getElementById('texto').value;
        const status = document.getElementById('status').value;

        if (!titulo) {
          alert('Por favor, digite um t√≠tulo para a hist√≥ria.');
          document.getElementById('titulo').focus();
          return;
        }

        const dataAtual = new Date();
        const dataISO = dataAtual.toISOString().split('T')[0];
        const dataFormatada = formatarDataBrasileira(dataISO);
        const horaAtual = dataAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        // Criar a primeira anota√ß√£o com o conte√∫do da hist√≥ria
        const primeiraAnotacao = {
          texto: texto,
          data: dataFormatada, // Salvar j√° no formato brasileiro
          hora: horaAtual,
          timestamp: dataAtual.getTime() // Adicionar timestamp para ordena√ß√£o
        };

        // Verificar se deve adicionar prazo de revis√£o - NOVO
        const reviewCheckbox = document.getElementById('reviewCheckbox');
        let prazoRevisao = null;
        let dataConfiguracaoRevisao = null;

        if (reviewCheckbox.checked) {
          // Calcular dias baseado na data selecionada
          if (selectedDateCreate) {
            const hoje = new Date();
            const dataSelecionada = new Date(selectedDateCreate);

            // Calcular diferen√ßa em dias
            const diffTime = dataSelecionada - hoje;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 1) {
              alert('Por favor, selecione uma data futura para a revis√£o.');
              toggleCalendar('create');
              return;
            }

            prazoRevisao = diffDays;
            dataConfiguracaoRevisao = dataFormatada; // Data da configura√ß√£o √© hoje
          } else {
            alert('Por favor, selecione uma data para a revis√£o.');
            toggleCalendar('create');
            return;
          }
        }

        dados[cliente].push({
          titulo: titulo,
          status: status,
          dataCriacao: dataFormatada, // Salvar j√° no formato brasileiro
          horaCriacao: horaAtual,
          dataEdicao: dataFormatada, // Salvar j√° no formato brasileiro
          horaEdicao: horaAtual,
          cliente: cliente,
          notas: [primeiraAnotacao], // O conte√∫do agora √© a primeira anota√ß√£o
          prazoRevisao: prazoRevisao, // NOVO: Adicionar prazo de revis√£o se definido
          dataConfiguracaoRevisao: dataConfiguracaoRevisao // NOVO: Data de configura√ß√£o
        });

        salvar();
        renderCards();

        // Limpar os campos, mas manter o cliente selecionado
        document.getElementById('titulo').value = '';
        document.getElementById('texto').value = '';

        // Resetar os campos de revis√£o
        const reviewFields = document.getElementById('reviewFieldsCreate'); // CORRIGIDO: Agora usa o ID correto
        document.getElementById('reviewCheckbox').checked = false;
        reviewFields.classList.add('hidden');
        document.getElementById('reviewDate').value = '';
        selectedDateCreate = null;

        // Foco no campo de texto para pr√≥xima hist√≥ria
        document.getElementById('texto').focus();

        // Voltar para a se√ß√£o de hist√≥rias salvas ap√≥s criar
        document.querySelector('.menu-item[data-section="historias-salvas"]').click();
      }

      function renderCards() {
        const container = document.getElementById('cards');
        const clienteSelecionado = document.getElementById('clienteSelectCards').value;
        const statusSelecionado = document.getElementById('statusFilter').value;

        // Verificar se h√° dados
        const totalHistorias = Object.values(dados).reduce((total, arr) => total + arr.length, 0);

        if (totalHistorias === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>Adicione clientes e crie hist√≥rias usando o menu.</p>
          </div>
        `;
          return;
        }

        // Se filtro de vencidas est√° ativo, mostrar apenas vencidas
        if (filtroVencidasAtivo) {
          mostrarApenasVencidas(container, clienteSelecionado, statusSelecionado);
        } else if (!clienteSelecionado && !statusSelecionado) {
          mostrarTodasHistorias(container);
        } else {
          mostrarHistoriasFiltradas(container, clienteSelecionado, statusSelecionado);
        }
      }

      // Nova fun√ß√£o para mostrar apenas hist√≥rias vencidas
      function mostrarApenasVencidas(container, clienteFiltro, statusFiltro) {
        container.innerHTML = '';

        let historiasVencidas = [];
        let clientesComHistoriasVencidas = [];

        // Coletar apenas hist√≥rias vencidas que correspondem aos filtros
        Object.keys(dados).forEach(cliente => {
          if (!clienteFiltro || cliente === clienteFiltro) {
            dados[cliente].forEach(historia => {
              if (historiaEstaVencida(historia)) {
                if (!statusFiltro || historia.status === statusFiltro) {
                  historiasVencidas.push({
                    cliente: cliente,
                    historia: historia,
                    index: dados[cliente].indexOf(historia)
                  });

                  if (!clientesComHistoriasVencidas.includes(cliente)) {
                    clientesComHistoriasVencidas.push(cliente);
                  }
                }
              }
            });
          }
        });

        if (historiasVencidas.length === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria vencida</h3>
            <p>N√£o h√° hist√≥rias vencidas que correspondam aos filtros selecionados.</p>
          </div>
        `;
          return;
        }

        // T√≠tulo para o filtro de vencidas
        const filtroTitle = document.createElement('div');
        filtroTitle.style.cssText = `
        grid-column: 1 / -1;
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--danger);
        display: flex;
        align-items: center;
        gap: 8px;
      `;

        let titulo = '‚ö†Ô∏è Hist√≥rias Vencidas';
        if (clienteFiltro) {
          titulo = `‚ö†Ô∏è Hist√≥rias Vencidas - Cliente: ${clienteFiltro}`;
        }
        if (statusFiltro) {
          titulo += ` (Status: ${statusFiltro})`;
        }
        titulo += ` (${historiasVencidas.length} hist√≥rias)`;

        filtroTitle.innerHTML = `${titulo} <span style="margin-left: auto; font-size: 12px; color: var(--text-light); cursor: pointer;" onclick="toggleFiltroVencidas()">[Mostrar todas]</span>`;
        container.appendChild(filtroTitle);

        // Agrupar por cliente para melhor organiza√ß√£o
        const historiasPorCliente = {};

        historiasVencidas.forEach(item => {
          if (!historiasPorCliente[item.cliente]) {
            historiasPorCliente[item.cliente] = [];
          }
          historiasPorCliente[item.cliente].push(item);
        });

        // Adicionar cards agrupados por cliente
        Object.keys(historiasPorCliente).forEach(cliente => {
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 15px;
          font-weight: 600;
          color: var(--text);
          margin: 20px 0 8px 0;
          padding-bottom: 6px;
          border-bottom: 1px solid var(--border);
        `;
          clienteTitle.textContent = `Cliente: ${cliente}`;
          container.appendChild(clienteTitle);

          historiasPorCliente[cliente].forEach(item => {
            container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
          });
        });
      }

      function mostrarTodasHistorias(container) {
        container.innerHTML = '';

        Object.keys(dados).forEach(cliente => {
          if (dados[cliente].length > 0) {
            // Adicionar t√≠tulo do cliente
            const clienteTitle = document.createElement('div');
            clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin: 16px 0 8px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
          `;
            clienteTitle.textContent = `Cliente: ${cliente}`;
            container.appendChild(clienteTitle);

            // Adicionar cards do cliente
            dados[cliente].forEach((historia, index) => {
              container.appendChild(criarCardElement(cliente, historia, index));
            });
          }
        });
      }

      function mostrarHistoriasFiltradas(container, clienteFiltro, statusFiltro) {
        container.innerHTML = '';

        let historiasFiltradas = [];
        let clientesComHistorias = [];

        // Coletar todas as hist√≥rias que correspondem aos filtros
        Object.keys(dados).forEach(cliente => {
          if (!clienteFiltro || cliente === clienteFiltro) {
            dados[cliente].forEach(historia => {
              if (!statusFiltro || historia.status === statusFiltro) {
                historiasFiltradas.push({
                  cliente: cliente,
                  historia: historia,
                  index: dados[cliente].indexOf(historia)
                });

                if (!clientesComHistorias.includes(cliente)) {
                  clientesComHistorias.push(cliente);
                }
              }
            });
          }
        });

        if (historiasFiltradas.length === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>N√£o h√° hist√≥rias que correspondam aos filtros selecionados.</p>
          </div>
        `;
          return;
        }

        // Mostrar por cliente ou todas juntas dependendo dos filtros
        if (clienteFiltro) {
          // Filtro por cliente espec√≠fico
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 16px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

          let titulo = `Cliente: ${clienteFiltro}`;
          if (statusFiltro) {
            titulo += ` (Filtrado por status: ${statusFiltro})`;
          }
          titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

          clienteTitle.textContent = titulo;
          container.appendChild(clienteTitle);

          // Adicionar cards filtrados
          historiasFiltradas.forEach(item => {
            container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
          });
        } else {
          // Filtro apenas por status (ou nenhum filtro)
          const filtroTitle = document.createElement('div');
          filtroTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 16px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

          let titulo = 'Todas as hist√≥rias';
          if (statusFiltro) {
            titulo = `Hist√≥rias com status: ${statusFiltro}`;
          }
          titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

          filtroTitle.textContent = titulo;
          container.appendChild(filtroTitle);

          // Agrupar por cliente para melhor organiza√ß√£o
          const historiasPorCliente = {};

          historiasFiltradas.forEach(item => {
            if (!historiasPorCliente[item.cliente]) {
              historiasPorCliente[item.cliente] = [];
            }
            historiasPorCliente[item.cliente].push(item);
          });

          // Adicionar cards agrupados por cliente
          Object.keys(historiasPorCliente).forEach(cliente => {
            const clienteTitle = document.createElement('div');
            clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin: 20px 0 8px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
          `;
            clienteTitle.textContent = `Cliente: ${cliente}`;
            container.appendChild(clienteTitle);

            historiasPorCliente[cliente].forEach(item => {
              container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
            });
          });
        }
      }

      function criarCardElement(cliente, historia, index) {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.status = historia.status;

        // Formatar data para exibi√ß√£o
        const dataCriacao = historia.dataCriacao || 'N√£o informado';
        const horaCriacao = historia.horaCriacao || '';
        const dataEdicao = historia.dataEdicao || dataCriacao;
        const horaEdicao = historia.horaEdicao || horaCriacao;

        // Verificar quantas anota√ß√µes existem
        const numAnotacoes = historia.notas ? historia.notas.length : 0;

        // Calcular status de revis√£o se existir
        let reviewBadge = '';
        if (historia.prazoRevisao && historia.dataConfiguracaoRevisao) {
          const hoje = new Date();
          // Converter data de configura√ß√£o para formato correto
          const dataConfigISO = formatarDataISO(historia.dataConfiguracaoRevisao);
          const dataConfiguracao = new Date(dataConfigISO);
          const dataVencimento = new Date(dataConfiguracao);
          dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

          const diffTime = dataVencimento - hoje;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          if (diffDays > 0) {
            // Ainda tem tempo
            reviewBadge = `<div class="review-badge future">‚è∞ Revisar em: ${diffDays} ${diffDays === 1 ? 'dia' : 'dias'}</div>`;
          } else if (diffDays === 0) {
            // Vence hoje
            reviewBadge = `<div class="review-badge today">‚è∞ Revisar hoje</div>`;
          } else {
            // Vencido
            const diasAtraso = Math.abs(diffDays);
            reviewBadge = `<div class="review-badge overdue">‚è∞ Vencido h√°: ${diasAtraso} ${diasAtraso === 1 ? 'dia' : 'dias'}</div>`;
          }
        }

        card.innerHTML = `
        <div class="card-header">
          <div style="flex: 1;">
            <h3>${historia.titulo}</h3>
            ${reviewBadge}
          </div>
          <span class="status" data-status="${historia.status}">${historia.status}</span>
        </div>
        
        <div class="card-dates">
          <div class="date-info">
            <span class="label">Criado em:</span>
            <span class="value">${dataCriacao} ${horaCriacao ? `√†s ${horaCriacao}` : ''}</span>
          </div>
          <div class="date-info">
            <span class="label">Editado em:</span>
            <span class="value">${dataEdicao} ${horaEdicao ? `√†s ${horaEdicao}` : ''}</span>
          </div>
          <div class="date-info">
            <span class="label">Anota√ß√µes:</span>
            <span class="value">${numAnotacoes} anota√ß√µes</span>
          </div>
        </div>
        
        <div class="card-footer">
          <div class="card-actions">
            <button class="secondary small" onclick="abrirModal('${cliente}', ${index})">Editar</button>
            <button class="danger small" onclick="excluir('${cliente}', ${index})">Excluir</button>
          </div>
        </div>
      `;

        return card;
      }

      function excluir(cliente, index) {
        if (!confirm("Tem certeza que deseja excluir esta hist√≥ria?")) return;

        dados[cliente].splice(index, 1);
        salvar();
        renderCards();

        // Atualizar selects se o cliente ficou sem hist√≥rias
        if (dados[cliente].length === 0) {
          atualizarSelects();
        }
      }

      // ===== FUN√á√ïES DO CALEND√ÅRIO MODIFICADAS =====

      // Fun√ß√£o para formatar data como DD/MM/YYYY
      function formatDate(date) {
        if (!date) return '';
        const d = new Date(date);
        const day = d.getDate().toString().padStart(2, '0');
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        const year = d.getFullYear();
        return `${day}/${month}/${year}`;
      }

      // Fun√ß√£o para parse de data no formato DD/MM/YYYY
      function parseDate(dateString) {
        if (!dateString) return null;
        const parts = dateString.split('/');
        if (parts.length !== 3) return null;
        return new Date(parts[2], parts[1] - 1, parts[0]);
      }

      // Fun√ß√£o para alternar visibilidade do calend√°rio
      function toggleCalendar(context) {
        calendarContext = context;
        const calendarModal = document.getElementById(`calendarModal${capitalizeFirstLetter(context)}`);
        calendarVisible = !calendarVisible;

        if (calendarVisible) {
          calendarModal.classList.add('active');
          renderCalendar(context);

          // Fechar calend√°rio ao clicar fora
          setTimeout(() => {
            document.addEventListener('click', function closeCalendarOnClickOutside(event) {
              const calendarModal = document.getElementById(`calendarModal${capitalizeFirstLetter(context)}`);
              const dateInput = document.getElementById(context === 'edit' ? 'editReviewDate' : 'reviewDate');
              const calendarToggle = calendarModal.parentElement.querySelector('.calendar-toggle-btn');

              if (!calendarModal.contains(event.target) &&
                event.target !== dateInput &&
                event.target !== calendarToggle) {
                closeCalendar();
                document.removeEventListener('click', closeCalendarOnClickOutside);
              }
            });
          }, 10);
        } else {
          closeCalendar();
        }
      }

      function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      // Fechar calend√°rio
      function closeCalendar() {
        const editModal = document.getElementById('calendarModalEdit');
        const createModal = document.getElementById('calendarModalCreate');

        if (editModal) editModal.classList.remove('active');
        if (createModal) createModal.classList.remove('active');

        calendarVisible = false;
      }

      // Renderizar calend√°rio
      function renderCalendar(context) {
        const monthYearElement = document.getElementById(`calendarMonthYear${capitalizeFirstLetter(context)}`);
        const daysElement = document.getElementById(`calendarDays${capitalizeFirstLetter(context)}`);

        // Configurar m√™s e ano atual
        const monthNames = [
          'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];

        const currentMonth = currentCalendarDate.getMonth();
        const currentYear = currentCalendarDate.getFullYear();

        monthYearElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        // Limpar dias anteriores
        daysElement.innerHTML = '';

        // Primeiro dia do m√™s
        const firstDay = new Date(currentYear, currentMonth, 1);
        // √öltimo dia do m√™s
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        // Dia da semana do primeiro dia (0 = Domingo, 6 = S√°bado)
        const firstDayOfWeek = firstDay.getDay();

        // Hoje
        const today = new Date();
        const isToday = (day) =>
          day.getDate() === today.getDate() &&
          day.getMonth() === today.getMonth() &&
          day.getFullYear() === today.getFullYear();

        // Data selecionada
        const selectedDateVar = context === 'edit' ? selectedDate : selectedDateCreate;
        const isSelected = (day) =>
          selectedDateVar &&
          day.getDate() === selectedDateVar.getDate() &&
          day.getMonth() === selectedDateVar.getMonth() &&
          day.getFullYear() === selectedDateVar.getFullYear();

        // Adicionar dias do m√™s anterior
        const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
          const day = new Date(currentYear, currentMonth - 1, prevMonthLastDay - i);
          const button = document.createElement('button');
          button.className = 'calendar-day other-month';
          button.textContent = day.getDate();
          button.disabled = true;
          daysElement.appendChild(button);
        }

        // Adicionar dias do m√™s atual
        for (let day = 1; day <= lastDay.getDate(); day++) {
          const date = new Date(currentYear, currentMonth, day);
          const button = document.createElement('button');
          button.className = 'calendar-day';
          button.textContent = day;

          // Marcar hoje
          if (isToday(date)) {
            button.classList.add('today');
          }

          // Marcar selecionado
          if (isSelected(date)) {
            button.classList.add('selected');
          }

          // Desabilitar datas passadas
          const todayMidnight = new Date(today.getFullYear(), today.getMonth(), today.getDate());
          const dateMidnight = new Date(date.getFullYear(), date.getMonth(), date.getDate());

          if (dateMidnight < todayMidnight) {
            button.classList.add('disabled');
            button.disabled = true;
          } else {
            button.onclick = () => selectDate(date, context);
          }

          daysElement.appendChild(button);
        }

        // Adicionar dias do pr√≥ximo m√™s
        const totalCells = 42; // 6 semanas * 7 dias
        const daysInMonth = lastDay.getDate();
        const daysSoFar = firstDayOfWeek + daysInMonth;
        const nextMonthDays = totalCells - daysSoFar;

        for (let i = 1; i <= nextMonthDays; i++) {
          const day = new Date(currentYear, currentMonth + 1, i);
          const button = document.createElement('button');
          button.className = 'calendar-day other-month';
          button.textContent = i;
          button.disabled = true;
          daysElement.appendChild(button);
        }
      }

      // Mudar m√™s no calend√°rio
      function changeMonth(context, delta) {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
        renderCalendar(context);
      }

      // Selecionar data
      function selectDate(date, context) {
        if (context === 'edit') {
          selectedDate = date;
          document.getElementById('editReviewDate').value = formatDate(date);
        } else {
          selectedDateCreate = date;
          document.getElementById('reviewDate').value = formatDate(date);
        }
        closeCalendar();
      }

      // Selecionar hoje
      function selectToday(context) {
        const today = new Date();
        selectDate(today, context);
      }

      // Limpar data
      function clearDate(context) {
        if (context === 'edit') {
          selectedDate = null;
          document.getElementById('editReviewDate').value = '';
        } else {
          selectedDateCreate = null;
          document.getElementById('reviewDate').value = '';
        }
        closeCalendar();
      }

      // ===== FUN√á√ïES DO MODAL MODIFICADAS =====

      function abrirModal(cliente, index) {
        editCliente = cliente;
        editIndex = index;

        const historia = dados[cliente][index];
        document.getElementById('editTitulo').value = historia.titulo;
        document.getElementById('editStatus').value = historia.status;
        document.getElementById('currentClienteName').textContent = cliente;

        // Configurar campos de revis√£o
        const reviewCheckbox = document.getElementById('editReviewCheckbox');
        const reviewFields = document.getElementById('reviewFieldsEdit'); // CORRIGIDO: Agora usa o ID correto

        // Resetar calend√°rio
        currentCalendarDate = new Date();
        selectedDate = null;

        if (historia.prazoRevisao && historia.dataConfiguracaoRevisao) {
          reviewCheckbox.checked = true;
          reviewFields.classList.remove('hidden');

          // Calcular data de vencimento baseado na configura√ß√£o
          const dataConfigISO = formatarDataISO(historia.dataConfiguracaoRevisao);
          const dataConfiguracao = new Date(dataConfigISO);
          const dataVencimento = new Date(dataConfiguracao);
          dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

          selectedDate = dataVencimento;
          document.getElementById('editReviewDate').value = formatDate(dataVencimento);
        } else {
          reviewCheckbox.checked = false;
          reviewFields.classList.add('hidden');
          document.getElementById('editReviewDate').value = '';
        }

        // Garantir que a propriedade notas exista
        if (!historia.notas) {
          historia.notas = [];
        }

        // Renderizar anota√ß√µes (agora ordenadas por data/hora mais recente)
        renderizarAnotacoes(historia.notas);

        document.getElementById('modal').classList.add('active');

        // Foco no t√≠tulo ao abrir o modal
        setTimeout(() => {
          document.getElementById('editTitulo').focus();
        }, 100);
      }

      function fecharModal() {
        document.getElementById('modal').classList.remove('active');
        editCliente = null;
        editIndex = null;
        closeCalendar();
      }

      function toggleReviewFields() {
        const reviewCheckbox = document.getElementById('editReviewCheckbox');
        const reviewFields = document.getElementById('reviewFieldsEdit'); // CORRIGIDO: Agora usa o ID correto

        if (reviewCheckbox.checked) {
          reviewFields.classList.remove('hidden');
          // Se n√£o houver data selecionada, sugerir 7 dias a partir de hoje
          if (!selectedDate) {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 7);
            selectedDate = futureDate;
            document.getElementById('editReviewDate').value = formatDate(futureDate);
          }
        } else {
          reviewFields.classList.add('hidden');
          selectedDate = null;
          document.getElementById('editReviewDate').value = '';
        }
      }

      function salvarEdicao() {
        const titulo = document.getElementById('editTitulo').value.trim();

        if (!titulo) {
          alert('O t√≠tulo √© obrigat√≥rio.');
          document.getElementById('editTitulo').focus();
          return;
        }

        const dataAtual = new Date();
        const dataFormatada = formatarDataBrasileira(dataAtual.toISOString().split('T')[0]);
        const horaAtual = dataAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        // Preservar dados existentes e atualizar
        const historiaExistente = dados[editCliente][editIndex];

        // Preservar anota√ß√µes se existirem (mantendo a ordena√ß√£o correta)
        const notas = historiaExistente.notas || [];

        // Verificar se deve adicionar/remover prazo de revis√£o
        const reviewCheckbox = document.getElementById('editReviewCheckbox');

        let prazoRevisao = null;
        let dataConfiguracaoRevisao = null;

        if (reviewCheckbox.checked) {
          // Calcular dias baseado na data selecionada
          if (selectedDate) {
            const hoje = new Date();
            const dataSelecionada = new Date(selectedDate);

            // Calcular diferen√ßa em dias
            const diffTime = dataSelecionada - hoje;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 1) {
              alert('Por favor, selecione uma data futura para a revis√£o.');
              toggleCalendar('edit');
              return;
            }

            prazoRevisao = diffDays;
            dataConfiguracaoRevisao = dataFormatada; // Data da configura√ß√£o √© hoje
          } else {
            alert('Por favor, selecione uma data para a revis√£o.');
            toggleCalendar('edit');
            return;
          }
        }

        dados[editCliente][editIndex] = {
          titulo: titulo,
          status: document.getElementById('editStatus').value,
          dataCriacao: historiaExistente.dataCriacao || dataFormatada,
          horaCriacao: historiaExistente.horaCriacao || horaAtual,
          dataEdicao: dataFormatada,
          horaEdicao: horaAtual,
          cliente: editCliente,
          notas: notas, // Preservar anota√ß√µes
          prazoRevisao: prazoRevisao,
          dataConfiguracaoRevisao: dataConfiguracaoRevisao
        };

        salvar();
        fecharModal();
        renderCards();
      }

      // ===== FUN√á√ïES PARA ANOTA√á√ïES =====

      // Fun√ß√£o auxiliar para ordenar anota√ß√µes por data/hora mais recente
      function ordenarAnotacoes(notas) {
        if (!notas || notas.length === 0) return [];

        return notas.sort((a, b) => {
          // Primeiro, verificar se tem timestamp (mais preciso)
          if (a.timestamp && b.timestamp) {
            return b.timestamp - a.timestamp; // Mais recente primeiro
          }

          // Se n√£o tem timestamp, tentar comparar data + hora
          const dataA = a.data ? new Date(formatarDataISO(a.data)) : new Date(0);
          const dataB = b.data ? new Date(formatarDataISO(b.data)) : new Date(0);

          if (dataA.getTime() !== dataB.getTime()) {
            return dataB.getTime() - dataA.getTime(); // Mais recente primeiro
          }

          // Se datas s√£o iguais, comparar horas
          if (a.hora && b.hora) {
            const horaA = a.hora.split(':').map(Number);
            const horaB = b.hora.split(':').map(Number);

            if (horaA[0] !== horaB[0]) return horaB[0] - horaA[0];
            if (horaA[1] !== horaB[1]) return horaB[1] - horaA[1];
          }

          return 0;
        });
      }

      // Fun√ß√£o para preservar quebras de linha no HTML
      function preservarQuebrasDeLinha(texto) {
        if (!texto) return '';
        // Substituir quebras de linha por tags <br>
        return texto.replace(/\n/g, '<br>');
      }

      // Fun√ß√£o para reverter quebras de linha ao editar
      function reverterQuebrasDeLinha(texto) {
        if (!texto) return '';
        // Substituir tags <br> por quebras de linha reais
        return texto.replace(/<br\s*\/?>/gi, '\n');
      }

      function renderizarAnotacoes(notas) {
        const container = document.getElementById('notesContainer');

        if (!notas || notas.length === 0) {
          container.innerHTML = `
          <div class="note-item">
            <div class="note-content note-content-placeholder">
              Nenhuma anota√ß√£o ainda. Clique em "Nova Anota√ß√£o" para adicionar.
            </div>
          </div>
        `;
          return;
        }

        container.innerHTML = '';

        // Ordenar anota√ß√µes por data/hora mais recente
        const notasOrdenadas = ordenarAnotacoes(notas);

        notasOrdenadas.forEach((nota, index) => {
          // Verificar se a anota√ß√£o est√° em modo de edi√ß√£o
          if (nota.editando) {
            // Se estiver em modo de edi√ß√£o, criar o formul√°rio de edi√ß√£o
            criarFormularioEdicaoAnotacao(container, nota, index);
          } else {
            // Se n√£o, criar a visualiza√ß√£o normal
            criarVisualizacaoAnotacao(container, nota, index);
          }
        });
      }

      function criarVisualizacaoAnotacao(container, nota, index) {
        const noteElement = document.createElement('div');
        noteElement.className = 'note-item';

        // Preservar quebras de linha no conte√∫do
        const conteudoComQuebras = preservarQuebrasDeLinha(nota.texto);

        noteElement.innerHTML = `
          <div class="note-header">
            <span class="note-date">${nota.data} ${nota.hora ? `√†s ${nota.hora}` : ''}</span>
            <button class="note-expand-btn" onclick="alternarExpansaoAnotacao(${index})">+</button>
          </div>
          <div class="note-content" id="noteContent${index}">
            ${conteudoComQuebras || ''}
          </div>
          <div class="note-actions">
            <button class="secondary small" onclick="editarAnotacao(${index})">Editar</button>
            <button class="danger small" onclick="excluirAnotacao(${index})">Excluir</button>
          </div>
        `;
        container.appendChild(noteElement);
      }

      function criarFormularioEdicaoAnotacao(container, nota, index) {
        const noteElement = document.createElement('div');
        noteElement.className = 'note-item';

        // Reverter quebras de linha para o textarea
        const textoParaEdicao = reverterQuebrasDeLinha(nota.texto);

        noteElement.innerHTML = `
          <div class="note-header">
            <span class="note-date">${nota.data} ${nota.hora ? `√†s ${nota.hora}` : ''}</span>
          </div>
          <textarea class="note-edit-input" id="editNoteInput${index}" placeholder="Digite sua anota√ß√£o...">${textoParaEdicao || ''}</textarea>
          <div class="note-actions">
            <button class="secondary small" onclick="cancelarEdicaoAnotacao(${index})">Cancelar</button>
            <button class="primary small" onclick="salvarEdicaoAnotacao(${index})">Salvar</button>
          </div>
        `;
        container.appendChild(noteElement);

        // Focar no textarea ap√≥s um pequeno delay para garantir que o elemento foi renderizado
        setTimeout(() => {
          const textarea = document.getElementById(`editNoteInput${index}`);
          if (textarea) {
            textarea.focus();
            // Colocar cursor no final do texto
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
          }
        }, 50);
      }

      function adicionarNovaAnotacao() {
        const container = document.getElementById('notesContainer');

        // Se estiver mostrando a mensagem de "nenhuma anota√ß√£o", remov√™-la
        if (container.innerHTML.includes('Nenhuma anota√ß√£o')) {
          container.innerHTML = '';
        }

        const dataAtual = new Date();
        const dataFormatada = formatarDataBrasileira(dataAtual.toISOString().split('T')[0]);
        const horaAtual = dataAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        const timestampAtual = dataAtual.getTime();

        // Criar nova nota com flag de edi√ß√£o
        const novaNota = {
          texto: '',
          data: dataFormatada,
          hora: horaAtual,
          timestamp: timestampAtual, // Adicionar timestamp para ordena√ß√£o
          editando: true // Flag para indicar que est√° em modo de edi√ß√£o
        };

        // Garantir que a array de notas exista
        if (!dados[editCliente][editIndex].notas) {
          dados[editCliente][editIndex].notas = [];
        }

        // Adicionar nova anota√ß√£o NO IN√çCIO da array (para aparecer no topo)
        dados[editCliente][editIndex].notas.unshift(novaNota);
        salvar();

        // Renderizar anota√ß√µes novamente - agora com a nova j√° em modo de edi√ß√£o no topo
        renderizarAnotacoes(dados[editCliente][editIndex].notas);
      }

      function alternarExpansaoAnotacao(index) {
        const notasOrdenadas = ordenarAnotacoes(dados[editCliente][editIndex].notas);
        const notaOriginalIndex = encontrarIndiceOriginal(index, notasOrdenadas);

        if (notaOriginalIndex === -1) return;

        const noteContent = document.getElementById(`noteContent${notaOriginalIndex}`);
        const expandBtn = document.querySelectorAll('.note-expand-btn')[notaOriginalIndex];

        if (!noteContent || !expandBtn) return;

        if (noteContent.classList.contains('expanded')) {
          noteContent.classList.remove('expanded');
          expandBtn.textContent = '+';
        } else {
          noteContent.classList.add('expanded');
          expandBtn.textContent = '-';
        }
      }

      // Fun√ß√£o auxiliar para encontrar o √≠ndice original no array ordenado
      function encontrarIndiceOriginal(indexOrdenado, notasOrdenadas) {
        if (!notasOrdenadas[indexOrdenado]) return -1;

        const notasOriginais = dados[editCliente][editIndex].notas;
        const notaProcurada = notasOrdenadas[indexOrdenado];

        // Encontrar a nota no array original
        for (let i = 0; i < notasOriginais.length; i++) {
          if (notasOriginais[i] === notaProcurada) {
            return i;
          }
        }
        return -1;
      }

      function editarAnotacao(index) {
        const notasOrdenadas = ordenarAnotacoes(dados[editCliente][editIndex].notas);
        const notaOriginalIndex = encontrarIndiceOriginal(index, notasOrdenadas);

        if (notaOriginalIndex === -1) return;

        const notas = dados[editCliente][editIndex].notas;
        const nota = notas[notaOriginalIndex];

        // Marcar a nota como em modo de edi√ß√£o
        nota.editando = true;

        // Salvar o estado
        salvar();

        // Re-renderizar as anota√ß√µes
        renderizarAnotacoes(notas);
      }

      function salvarEdicaoAnotacao(index) {
        const notasOrdenadas = ordenarAnotacoes(dados[editCliente][editIndex].notas);
        const notaOriginalIndex = encontrarIndiceOriginal(index, notasOrdenadas);

        if (notaOriginalIndex === -1) return;

        const notas = dados[editCliente][editIndex].notas;
        const nota = notas[notaOriginalIndex];
        const novoTexto = document.getElementById(`editNoteInput${index}`).value.trim();

        if (novoTexto) {
          nota.texto = novoTexto;

          const dataAtual = new Date();
          nota.data = formatarDataBrasileira(dataAtual.toISOString().split('T')[0]);
          nota.hora = dataAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
          nota.timestamp = dataAtual.getTime(); // Atualizar timestamp para ordena√ß√£o
          nota.editando = false; // Remover flag de edi√ß√£o

          salvar();
          renderizarAnotacoes(notas);
        } else {
          alert('A anota√ß√£o n√£o pode estar vazia.');
          document.getElementById(`editNoteInput${index}`).focus();
        }
      }

      function cancelarEdicaoAnotacao(index) {
        const notasOrdenadas = ordenarAnotacoes(dados[editCliente][editIndex].notas);
        const notaOriginalIndex = encontrarIndiceOriginal(index, notasOrdenadas);

        if (notaOriginalIndex === -1) return;

        const notas = dados[editCliente][editIndex].notas;
        const nota = notas[notaOriginalIndex];

        // Se for uma anota√ß√£o nova (texto vazio), remov√™-la
        if (!nota.texto || nota.texto.trim() === '') {
          notas.splice(notaOriginalIndex, 1);
        } else {
          // Se for uma anota√ß√£o existente, apenas remover o modo de edi√ß√£o
          nota.editando = false;
        }

        salvar();
        renderizarAnotacoes(notas);
      }

      function excluirAnotacao(index) {
        const notasOrdenadas = ordenarAnotacoes(dados[editCliente][editIndex].notas);
        const notaOriginalIndex = encontrarIndiceOriginal(index, notasOrdenadas);

        if (notaOriginalIndex === -1) return;

        if (!confirm('Tem certeza que deseja excluir esta anota√ß√£o?')) return;

        dados[editCliente][editIndex].notas.splice(notaOriginalIndex, 1);
        salvar();
        renderizarAnotacoes(dados[editCliente][editIndex].notas);
      }

      // FUN√á√ïES PARA IMPORTAR/EXPORTAR DADOS
      function exportarDados() {
        // Obter todos os dados do localStorage
        const dadosCompletos = {
          clientes: dados,
          equipes: dadosEquipes,
          exportadoEm: new Date().toISOString(),
          versao: '1.4' // Atualizado para incluir prazo de revis√£o na cria√ß√£o
        };

        // Converter para JSON
        const jsonDados = JSON.stringify(dadosCompletos, null, 2);

        // Criar um blob e fazer download
        const blob = new Blob([jsonDados], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `historias-clientes-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('Dados exportados com sucesso!');
      }

      function importarDados() {
        const fileInput = document.getElementById('jsonFile');
        const file = fileInput.files[0];

        if (!file) {
          alert('Por favor, selecione um arquivo JSON para importar.');
          return;
        }

        if (!confirm('ATEN√á√ÉO: Isso ir√° substituir todos os dados atuais. Tem certeza que deseja continuar?')) {
          return;
        }

        const reader = new FileReader();

        reader.onload = function (e) {
          try {
            const dadosImportados = JSON.parse(e.target.result);

            // Verificar se √© um formato v√°lido
            if (!dadosImportados.clientes) {
              throw new Error('Formato de arquivo inv√°lido. O arquivo deve conter dados de clientes.');
            }

            // Atualizar os dados
            dados = dadosImportados.clientes;
            dadosEquipes = dadosImportados.equipes || {};
            salvar();

            // Atualizar a interface
            atualizarSelects();
            atualizarContadorVencidas();
            renderCards();
            renderClientesList();
            renderEquipesList();

            // Limpar o input de arquivo
            fileInput.value = '';

            alert('Dados importados com sucesso!');
          } catch (error) {
            alert(`Erro ao importar dados: ${error.message}`);
            console.error('Erro na importa√ß√£o:', error);
          }
        };

        reader.onerror = function () {
          alert('Erro ao ler o arquivo. Por favor, tente novamente.');
        };

        reader.readAsText(file);
      }

      function excluirTodosDados() {
        if (!confirm('ATEN√á√ÉO: Esta a√ß√£o excluir√° permanentemente TODOS os dados (clientes, hist√≥rias, cards, anota√ß√µes e equipes). Esta a√ß√£o N√ÉO pode ser desfeita.\n\nTem certeza absoluta que deseja continuar?')) {
          return;
        }

        if (!confirm('√öLTIMO AVISO: Todos os seus dados ser√£o PERDIDOS para sempre. Clique em OK apenas se tiver certeza absoluta.')) {
          return;
        }

        dados = {};
        dadosEquipes = {};
        salvar();
        atualizarSelects();
        atualizarContadorVencidas();
        renderCards();
        renderClientesList();
        renderEquipesList();

        alert('Todos os dados foram exclu√≠dos com sucesso.');
      }
    </script>




</body>


</html>
