<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hist√≥rias por Cliente</title>

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      --overlay: rgba(15, 23, 42, 0.8);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --api-color: #8b5cf6;
      --danger-hover: #dc2626;
      --radius: 8px;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.12);
      --expand-color: #3b82f6;
      --note-bg: #f0f9ff;
      --note-border: #bae6fd;
      --review-soon: #f59e0b;
      --review-today: #ef4444;
      --review-future: #10b981;
      --filter-active: #3b82f6;
      --filter-badge: #ef4444;
    }

    body.dark {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --primary: #60a5fa;
      --primary-hover: #3b82f6;
      --border: #334155;
      --border-light: #2d3748;
      --overlay: rgba(0, 0, 0, 0.85);
      --api-color: #a78bfa;
      --expand-color: #60a5fa;
      --note-bg: #1e3a5f;
      --note-border: #2563eb;
      --review-soon: #f59e0b;
      --review-today: #ef4444;
      --review-future: #10b981;
      --filter-active: #60a5fa;
      --filter-badge: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Cabe√ßalho com menu hamb√∫rguer */
    .header {
      padding: 16px 0;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 24px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
    }

    /* Menu Hamb√∫rguer */
    .menu-toggle {
      background: none;
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--border-light);
    }

    .menu-toggle span {
      display: block;
      width: 22px;
      height: 2px;
      background: var(--text);
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    .menu-toggle.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .menu-toggle.active span:nth-child(2) {
      opacity: 0;
    }

    .menu-toggle.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Menu Lateral */
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .menu-sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 300px;
      height: 100%;
      background: var(--card);
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
    }

    .menu-sidebar.active {
      left: 0;
    }

    .menu-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-header h2 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
    }

    .menu-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-light);
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .menu-close:hover {
      background: var(--border-light);
      color: var(--text);
    }

    .menu-items {
      padding: 12px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      color: var(--text);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
      border-left: 4px solid transparent;
    }

    .menu-item:hover {
      background: var(--border-light);
      border-left-color: var(--primary);
    }

    .menu-item.active {
      background: rgba(59, 130, 246, 0.1);
      border-left-color: var(--primary);
      color: var(--primary);
      font-weight: 600;
    }

    .menu-item-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    /* Conte√∫do Principal */
    .main-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .main-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* SE√á√ÉO: Criar Nova Hist√≥ria - LAYOUT SIMPLIFICADO */
    .section-creation {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title::before {
      content: "‚úèÔ∏è";
      font-size: 16px;
    }

    /* SE√á√ÉO: Adicionar Cliente */
    .section-add-client {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-add-client .section-title::before {
      content: "üë§";
      font-size: 16px;
    }

    /* SE√á√ÉO: Gerenciar Dados */
    .section-data-management {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      height: fit-content;
      max-width: 800px;
      margin: 0 auto;
    }

    .section-data-management .section-title::before {
      content: "üíæ";
      font-size: 16px;
    }

    /* Formul√°rio de cliente */
    .client-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group label::before {
      content: "‚Üí";
      color: var(--primary);
      font-weight: bold;
      font-size: 12px;
    }

    input,
    textarea,
    select,
    button {
      font-family: inherit;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      transition: all 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    input,
    select {
      padding: 10px 12px;
      height: 42px;
    }

    /* √Årea de cria√ß√£o de hist√≥rias - LAYOUT SIMPLIFICADO */
    .story-creation {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* REMOVIDA a barra de ferramentas de formata√ß√£o */

    /* √Årea de texto grande - PRIMEIRO no layout */
    .story-textarea-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    #texto {
      width: 100%;
      min-height: 200px;
      padding: 16px;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.6;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
      color: var(--text);
      resize: vertical;
      transition: border-color 0.2s ease;
    }

    #texto:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Campos de sele√ß√£o - SEGUNDO no layout */
    .story-selection-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    @media (max-width: 640px) {
      .story-selection-fields {
        grid-template-columns: 1fr;
      }
    }

    .story-form-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    button {
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border: none;
      transition: all 0.2s ease;
      font-size: 14px;
      border-radius: 6px;
    }

    button.primary {
      background: var(--primary);
      color: white;
    }

    button.primary:hover {
      background: var(--primary-hover);
      box-shadow: var(--shadow);
    }

    button.secondary {
      background: var(--border-light);
      color: var(--text);
    }

    button.secondary:hover {
      background: var(--border);
    }

    button.danger {
      background: var(--danger);
      color: white;
    }

    button.danger:hover {
      background: var(--danger-hover);
    }

    button.small {
      padding: 6px 12px;
      font-size: 12px;
    }

    button.full-width {
      width: 100%;
    }

    /* SE√á√ÉO: Visualiza√ß√£o dos Cards - MANTIDO IGUAL */
    .section-cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .cards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
    }

    .cards-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .cards-header h2::before {
      content: "üìã";
      font-size: 18px;
    }

    /* ===== FILTROS MODIFICADOS - COM FILTRO DE VENCIDAS ===== */
    .filters-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
      padding: 0;
    }

    .filter-group label {
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      font-size: 13px;
      min-width: auto;
    }

    #clienteSelectCards,
    #statusFilter {
      min-width: 150px;
      padding: 6px 10px;
      font-size: 13px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    #clienteSelectCards:hover,
    #statusFilter:hover {
      border-color: var(--primary);
    }

    #clienteSelectCards:focus,
    #statusFilter:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Bot√£o de filtro de vencidas - NOVO */
    .filter-vencidas-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
    }

    .filter-vencidas-btn:hover {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }

    .filter-vencidas-btn.active {
      background: rgba(239, 68, 68, 0.1);
      border-color: var(--danger);
      color: var(--danger);
      font-weight: 700;
    }

    .filter-vencidas-btn .badge {
      background: var(--filter-badge);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 1px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
      margin-left: 2px;
    }

    .cards-container {
      flex: 1;
      margin-top: 16px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    /* CARD MODIFICADO - Com badge de revis√£o */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-top: 4px solid var(--border);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .card[data-status="Resolvido"] {
      border-top-color: var(--success);
    }

    .card[data-status="Importante"] {
      border-top-color: var(--warning);
    }

    .card[data-status="Pendente"] {
      border-top-color: var(--danger);
    }

    .card[data-status="API"] {
      border-top-color: var(--api-color);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .card h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
      margin-right: 12px;
    }

    /* Status badge */
    .status {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      background: var(--border-light);
      white-space: nowrap;
    }

    .status[data-status="Resolvido"] {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status[data-status="Importante"] {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .status[data-status="Pendente"] {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .status[data-status="API"] {
      background: rgba(139, 92, 246, 0.1);
      color: var(--api-color);
    }

    /* Badge de revis√£o */
    .review-badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      margin-top: 4px;
      white-space: nowrap;
    }

    .review-badge.future {
      background: rgba(16, 185, 129, 0.1);
      color: var(--review-future);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .review-badge.today {
      background: rgba(245, 158, 11, 0.1);
      color: var(--review-today);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .review-badge.overdue {
      background: rgba(239, 68, 68, 0.1);
      color: var(--review-today);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    /* Informa√ß√µes de data */
    .card-dates {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
      padding: 10px;
      background: var(--border-light);
      border-radius: 6px;
      font-size: 12px;
    }

    .date-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-light);
    }

    .date-info .label {
      font-weight: 600;
      color: var(--text);
      min-width: 70px;
    }

    .date-info .value {
      flex: 1;
    }

    /* A√ß√µes do card */
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    /* Lista de clientes */
    .clients-list {
      margin-top: 20px;
      border-top: 1px solid var(--border-light);
      padding-top: 20px;
    }

    .clients-list h3 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
    }

    .client-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: var(--border-light);
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .client-item-actions {
      display: flex;
      gap: 8px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: var(--text);
    }

    .empty-state p {
      max-width: 400px;
      margin: 0 auto;
      font-size: 14px;
    }

    /* Op√ß√µes de gerenciamento de dados */
    .data-options {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
    }

    .data-option {
      padding: 16px;
      background: var(--border-light);
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .data-option h3 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .data-option p {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 12px;
    }

    /* ===== MODAL DE EDI√á√ÉO - MODIFICADO ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    .modal-box {
      background: var(--card);
      border-radius: var(--radius);
      width: 90%;
      height: 90%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      animation: modalSlideUp 0.3s ease;
    }

    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--border-light);
      flex-shrink: 0;
    }

    .modal-header h2 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-header h2::before {
      content: "üìù";
      font-size: 16px;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-light);
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text);
    }

    .modal-body {
      padding: 20px 24px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .modal-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-light);
    }

    .modal-status-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-status-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-light);
    }

    #editStatus {
      padding: 4px 8px;
      font-size: 13px;
      height: 28px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      font-weight: 500;
      min-width: 100px;
      transition: all 0.2s ease;
    }

    #editStatus:hover {
      border-color: var(--primary);
    }

    #editStatus:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Configura√ß√£o de prazo de revis√£o */
    .review-config {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--border-light);
    }

    .review-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .review-checkbox input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .review-checkbox label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
    }

    .review-fields {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-left: 24px;
      animation: fadeIn 0.3s ease;
    }

    .review-fields.hidden {
      display: none;
    }

    #editReviewDays {
      width: 60px;
      padding: 4px 8px;
      font-size: 13px;
      height: 28px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      text-align: center;
    }

    .review-fields span {
      font-size: 13px;
      color: var(--text-light);
      white-space: nowrap;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--border-light);
      flex-shrink: 0;
    }

    .client-info {
      color: var(--text-light);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .client-info strong {
      color: var(--text);
      font-weight: 600;
    }

    .modal-footer-actions {
      display: flex;
      gap: 8px;
    }

    .modal-footer-actions button {
      padding: 8px 16px;
      font-size: 13px;
      border-radius: 6px;
      font-weight: 600;
    }

    /* ===== SE√á√ÉO DE ANOTA√á√ïES ===== */
    .modal-notes-section {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .modal-notes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-notes-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-notes-title::before {
      content: "üìù";
      font-size: 14px;
    }

    .add-note-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }

    .add-note-btn:hover {
      background: var(--primary-hover);
    }

    .notes-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      min-height: 300px;
    }

    .note-item {
      background: var(--note-bg);
      border: 1px solid var(--note-border);
      border-radius: 6px;
      padding: 16px;
      position: relative;
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed var(--border);
    }

    .note-date {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 500;
    }

    .note-expand-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--expand-color);
      font-size: 16px;
      font-weight: bold;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .note-expand-btn:hover {
      background: rgba(59, 130, 246, 0.1);
    }

    .note-content {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text);
      max-height: 80px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .note-content.expanded {
      max-height: 500px;
      overflow-y: auto;
    }

    .note-content-placeholder {
      color: var(--text-light);
      font-style: italic;
      font-size: 13px;
      padding: 8px;
    }

    .note-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }

    .note-actions button {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 4px;
    }

    .note-edit-input {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      font-family: inherit;
      font-size: 14px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      resize: vertical;
      margin-bottom: 10px;
    }

    .note-edit-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    /* Responsividade */
    @media (max-width: 1024px) {
      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        justify-content: flex-start;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 140px;
      }

      .modal-box {
        width: 95%;
        height: 95%;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }

      .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .cards-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .filters-container {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .filter-group {
        width: 100%;
      }

      #clienteSelectCards,
      #statusFilter {
        min-width: 100%;
        width: 100%;
      }

      .filter-vencidas-btn {
        width: 100%;
        justify-content: center;
      }

      .modal-header,
      .modal-body,
      .modal-footer {
        padding: 16px;
      }

      .modal-box {
        width: 98%;
        height: 98%;
      }

      .form-section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .modal-status-container {
        width: 100%;
        justify-content: space-between;
      }

      .menu-sidebar {
        width: 280px;
      }

      .menu-item {
        padding: 12px 16px;
      }

      .card-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .card h3 {
        margin-right: 0;
      }

      .status {
        align-self: flex-start;
      }

      .modal-notes-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .add-note-btn {
        align-self: flex-end;
      }

      .review-fields {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      #editReviewDays {
        width: 100%;
      }
    }

    @media (max-width: 640px) {
      .cards-grid {
        grid-template-columns: 1fr;
      }

      .menu-sidebar {
        width: 260px;
      }

      .header-left {
        gap: 12px;
      }

      .header h1 {
        font-size: 20px;
      }

      .cards-header h2 {
        font-size: 18px;
      }

      .filter-group label {
        font-size: 12px;
      }

      #clienteSelectCards,
      #statusFilter {
        font-size: 12px;
        padding: 6px 8px;
        height: 30px;
      }

      .modal-footer {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .client-info {
        justify-content: center;
        text-align: center;
      }

      .modal-footer-actions {
        justify-content: center;
      }

      .note-item {
        padding: 12px;
      }

      .note-edit-input {
        min-height: 100px;
      }

      .card-dates {
        padding: 8px;
      }

      .date-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
      }

      .date-info .label {
        min-width: auto;
        font-size: 11px;
      }
    }

    @media (max-width: 1024px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
    }
  </style>
</head>

<body>

  <!-- Menu Hamb√∫rguer Overlay -->
  <div class="menu-overlay" id="menuOverlay"></div>

  <!-- Menu Lateral -->
  <div class="menu-sidebar" id="menuSidebar">
    <div class="menu-header">
      <h2>Menu</h2>
      <button class="menu-close" id="menuClose">√ó</button>
    </div>
    <div class="menu-items">
      <div class="menu-item active" data-section="historias-salvas">
        <span class="menu-item-icon">üìã</span>
        <span>Hist√≥rias Salvas</span>
      </div>
      <div class="menu-item" data-section="criar-historia">
        <span class="menu-item-icon">‚úèÔ∏è</span>
        <span>Criar Nova Hist√≥ria</span>
      </div>
      <div class="menu-item" data-section="adicionar-cliente">
        <span class="menu-item-icon">üë§</span>
        <span>Adicionar Cliente</span>
      </div>
      <div class="menu-item" data-section="gerenciar-dados">
        <span class="menu-item-icon">üíæ</span>
        <span>Gerenciar Dados</span>
      </div>
      <div class="menu-item" id="themeToggle">
        <span class="menu-item-icon" id="themeIcon">üåô</span>
        <span id="themeText">Tema Claro</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <h1>Hist√≥rias por Cliente</h1>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Hist√≥rias Salvas (vis√≠vel por padr√£o) - COM FILTRO DE VENCIDAS -->
    <div class="main-content active" id="historias-salvas">
      <div class="section-cards">
        <div class="cards-header">
          <h2>Hist√≥rias Salvas</h2>

          <!-- Filtros agora ao lado do t√≠tulo - COM BOT√ÉO DE VENCIDAS -->
          <div class="filters-container">
            <div class="filter-group">
              <label for="clienteSelectCards">Cliente:</label>
              <select id="clienteSelectCards" onchange="renderCards()">
                <option value="">Todos</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="statusFilter">Status:</label>
              <select id="statusFilter" onchange="renderCards()">
                <option value="">Todos</option>
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>

            <!-- Bot√£o para mostrar apenas hist√≥rias vencidas - NOVO -->
            <div class="filter-vencidas-btn" id="filterVencidasBtn" onclick="toggleFiltroVencidas()">
              <span>‚ö†Ô∏è Mostrar Vencidas</span>
              <span class="badge" id="vencidasCount">0</span>
            </div>
          </div>
        </div>

        <div class="cards-container">
          <div class="cards-grid" id="cards">
            <!-- Cards ser√£o renderizados aqui -->
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Criar Nova Hist√≥ria - LAYOUT SIMPLIFICADO -->
    <div class="main-content" id="criar-historia">
      <div class="section-creation">
        <h2 class="section-title">Criar Nova Hist√≥ria</h2>

        <!-- Formul√°rio de Criar Hist√≥rias - ORDEM ALTERADA -->
        <div class="story-creation">
          <!-- 1. √Årea de texto grande (PRIMEIRO) -->
          <div class="story-textarea-container">
            <label for="texto">Detalhes da Hist√≥ria</label>
            <textarea id="texto" placeholder="Digite os detalhes da hist√≥ria aqui..."></textarea>
          </div>

          <!-- 2. Campos de sele√ß√£o (SEGUNDO) -->
          <div class="story-selection-fields">
            <div class="form-group">
              <label for="clienteSelect">Cliente</label>
              <select id="clienteSelect">
                <option value="">Selecione um cliente</option>
              </select>
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <select id="status">
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>
          </div>

          <!-- 3. T√≠tulo (TERCEIRO) -->
          <div class="form-group">
            <label for="titulo">T√≠tulo da Hist√≥ria</label>
            <input id="titulo" placeholder="Digite um t√≠tulo para a hist√≥ria">
          </div>

          <!-- 4. A√ß√µes -->
          <div class="story-form-actions">
            <button class="primary full-width" onclick="addCard()">Salvar Hist√≥ria</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Adicionar Cliente - COM EDI√á√ÉO/EXCLUS√ÉO -->
    <div class="main-content" id="adicionar-cliente">
      <div class="section-add-client">
        <h2 class="section-title">Adicionar Cliente</h2>

        <!-- Formul√°rio de Adicionar Cliente -->
        <div class="client-form">
          <div class="form-group">
            <label for="clienteNome">Nome do Cliente</label>
            <div style="display: flex; gap: 12px;">
              <input id="clienteNome" placeholder="Digite o nome do cliente">
              <button class="primary" onclick="addCliente()" style="white-space: nowrap;">Adicionar Cliente</button>
            </div>
          </div>

          <!-- Lista de clientes cadastrados -->
          <div class="clients-list" id="clientsList">
            <h3>Clientes Cadastrados</h3>
            <!-- Clientes ser√£o listados aqui -->
          </div>
        </div>
      </div>
    </div>

    <!-- Conte√∫do: Gerenciar Dados - LAYOUT SIMPLIFICADO -->
    <div class="main-content" id="gerenciar-dados">
      <div class="section-data-management">
        <h2 class="section-title">Gerenciar Dados</h2>

        <!-- Op√ß√µes de gerenciamento -->
        <div class="data-options">
          <div class="data-option">
            <h3>üì• Exportar Dados</h3>
            <p>Exporta todos os dados (clientes, hist√≥rias, cards e anota√ß√µes) para um arquivo JSON.</p>
            <button class="primary full-width" onclick="exportarDados()">Exportar para JSON</button>
          </div>

          <div class="data-option">
            <h3>üì§ Importar Dados</h3>
            <p>Importa dados de um arquivo JSON. Substituir√° todos os dados atuais.</p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <input type="file" id="jsonFile" accept=".json" style="padding: 8px; font-size: 14px;">
              <button class="secondary full-width" onclick="importarDados()">Importar do JSON</button>
            </div>

            <div class="data-option">
              <h3>üóëÔ∏è Excluir Todos os Dados</h3>
              <p style="color: var(--danger);">ATEN√á√ÉO: Esta a√ß√£o excluir√° permanentemente todos os clientes, hist√≥rias, cards e anota√ß√µes. N√£o √© poss√≠vel desfazer.</p>
              <button class="danger full-width" onclick="excluirTodosDados()">Excluir Todos os Dados</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE HIST√ìRIA - COM CONFIGURA√á√ÉO DE PRAZO -->
    <div class="modal" id="modal">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Editar Hist√≥ria</h2>
          <button class="modal-close" onclick="fecharModal()">√ó</button>
        </div>

        <div class="modal-body">
          <!-- Formul√°rio b√°sico para t√≠tulo e status -->
          <div class="modal-form">
            <div class="form-group">
              <label for="editTitulo">T√≠tulo</label>
              <input id="editTitulo" placeholder="Digite o t√≠tulo da hist√≥ria">
            </div>

            <div class="modal-status-container">
              <span class="modal-status-label">Status:</span>
              <select id="editStatus">
                <option value="Pendente">Pendente</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Importante">Importante</option>
                <option value="API">API</option>
              </select>
            </div>

            <!-- Configura√ß√£o de prazo de revis√£o -->
            <div class="review-config">
              <div class="review-checkbox">
                <input type="checkbox" id="editReviewCheckbox" onchange="toggleReviewFields()">
                <label for="editReviewCheckbox">Definir prazo de revis√£o</label>
              </div>

              <div class="review-fields hidden" id="reviewFields">
                <input type="number" id="editReviewDays" min="1" max="365" value="7" style="width: 60px;">
                <span>dias</span>
              </div>
            </div>
          </div>

          <!-- SE√á√ÉO DE ANOTA√á√ïES -->
          <div class="modal-notes-section" id="notesSection">
            <div class="modal-notes-header">
              <h3 class="modal-notes-title">Anota√ß√µes da Hist√≥ria</h3>
              <button class="add-note-btn" onclick="adicionarNovaAnotacao()">
                <span>+</span>
                <span>Nova Anota√ß√£o</span>
              </button>
            </div>

            <div class="notes-container" id="notesContainer">
              <!-- Anota√ß√µes ser√£o renderizadas aqui -->
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="client-info">
            <span>Editando hist√≥ria de:</span>
            <strong id="currentClienteName"></strong>
          </div>

          <div class="modal-footer-actions">
            <button class="secondary" onclick="fecharModal()">Cancelar</button>
            <button class="primary" onclick="salvarEdicao()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE CLIENTE -->
    <div class="modal" id="modalCliente">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Editar Cliente</h2>
          <button class="modal-close" onclick="fecharModalCliente()">√ó</button>
        </div>

        <div class="modal-body">
          <div class="modal-form">
            <div class="form-group">
              <label for="editClienteNome">Nome do Cliente</label>
              <input id="editClienteNome" placeholder="Digite o nome do cliente">
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="modal-footer-actions">
            <button class="secondary" onclick="fecharModalCliente()">Cancelar</button>
            <button class="primary" onclick="salvarEdicaoCliente()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let dados = JSON.parse(localStorage.getItem("clientes")) || {};
      let editCliente = null;
      let editIndex = null;
      let editClienteNome = null;
      let filtroVencidasAtivo = false; // Estado do filtro de vencidas

      // Inicializa√ß√£o
      document.addEventListener('DOMContentLoaded', function () {
        // Configurar tema
        const isDark = localStorage.getItem("dark") === "true" ||
          (localStorage.getItem("dark") === null && window.matchMedia('(prefers-color-scheme: dark)').matches);

        if (isDark) {
          document.body.classList.add("dark");
        }
        atualizarTemaIcone(isDark);

        // Configurar menu
        setupMenu();

        // Configurar eventos
        setupModalEvents();

        // Inicializar dados
        atualizarSelects();
        atualizarContadorVencidas(); // Atualizar contador
        renderCards();
        renderClientesList();
      });

      // Configurar menu hamb√∫rguer
      function setupMenu() {
        const menuToggle = document.getElementById('menuToggle');
        const menuClose = document.getElementById('menuClose');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuSidebar = document.getElementById('menuSidebar');
        const menuItems = document.querySelectorAll('.menu-item');
        const sections = document.querySelectorAll('.main-content');
        const themeToggle = document.getElementById('themeToggle');

        // Abrir menu
        menuToggle.addEventListener('click', function () {
          menuSidebar.classList.add('active');
          menuOverlay.classList.add('active');
          menuToggle.classList.add('active');
        });

        // Fechar menu
        function closeMenu() {
          menuSidebar.classList.remove('active');
          menuOverlay.classList.remove('active');
          menuToggle.classList.remove('active');
        }

        menuClose.addEventListener('click', closeMenu);
        menuOverlay.addEventListener('click', closeMenu);

        // Alternar tema
        themeToggle.addEventListener('click', function () {
          toggleDark();
          closeMenu();
        });

        // Navegar entre se√ß√µes
        menuItems.forEach(item => {
          if (item === themeToggle) return; // Pular o bot√£o de tema

          item.addEventListener('click', function () {
            const sectionId = this.dataset.section;

            // Atualizar item ativo no menu
            menuItems.forEach(i => {
              if (i.dataset.section) {
                i.classList.remove('active');
              }
            });
            this.classList.add('active');

            // Mostrar se√ß√£o correspondente
            sections.forEach(section => {
              section.classList.remove('active');
              if (section.id === sectionId) {
                section.classList.add('active');
              }
            });

            // Fechar menu
            closeMenu();
          });
        });
      }

      function setupModalEvents() {
        // Fechar com ESC
        document.addEventListener('keydown', function (event) {
          if (event.key === 'Escape') {
            if (document.getElementById('modal').classList.contains('active')) {
              fecharModal();
            }
            if (document.getElementById('modalCliente').classList.contains('active')) {
              fecharModalCliente();
            }
          }
        });
      }

      function salvar() {
        localStorage.setItem("clientes", JSON.stringify(dados));
        atualizarContadorVencidas(); // Atualizar contador ap√≥s salvar
      }

      function toggleDark() {
        const body = document.body;
        body.classList.toggle("dark");
        const isDark = body.classList.contains("dark");
        localStorage.setItem("dark", isDark);
        atualizarTemaIcone(isDark);
      }

      function atualizarTemaIcone(isDark) {
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');

        if (isDark) {
          themeIcon.textContent = '‚òÄÔ∏è';
          themeText.textContent = 'Tema Claro';
        } else {
          themeIcon.textContent = 'üåô';
          themeText.textContent = 'Tema Escuro';
        }
      }

      function atualizarSelects() {
        // Atualizar select da se√ß√£o de cria√ß√£o
        const selectCriacao = document.getElementById('clienteSelect');
        selectCriacao.innerHTML = '<option value="">Selecione um cliente</option>';

        // Atualizar select da se√ß√£o de cards (filtro por cliente)
        const selectClienteCards = document.getElementById('clienteSelectCards');
        selectClienteCards.innerHTML = '<option value="">Todos</option>';

        Object.keys(dados).sort().forEach(cliente => {
          // Para select de cria√ß√£o
          const option1 = document.createElement('option');
          option1.value = cliente;
          option1.textContent = cliente;
          selectCriacao.appendChild(option1);

          // Para select de visualiza√ß√£o (filtro por cliente)
          const option2 = document.createElement('option');
          option2.value = cliente;
          option2.textContent = cliente;
          selectClienteCards.appendChild(option2);
        });
      }

      // Fun√ß√£o para contar hist√≥rias vencidas - NOVA
      function contarHistoriasVencidas() {
        let contador = 0;
        const hoje = new Date();

        Object.keys(dados).forEach(cliente => {
          dados[cliente].forEach(historia => {
            if (historia.prazoRevisao && historia.dataConfiguracaoRevisao) {
              const dataConfiguracao = new Date(historia.dataConfiguracaoRevisao);
              const dataVencimento = new Date(dataConfiguracao);
              dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

              const diffTime = dataVencimento - hoje;
              const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

              // Contar apenas hist√≥rias vencidas (dias negativos)
              if (diffDays < 0) {
                contador++;
              }
            }
          });
        });

        return contador;
      }

      // Atualizar contador de vencidas no bot√£o - NOVA
      function atualizarContadorVencidas() {
        const contador = contarHistoriasVencidas();
        const badgeElement = document.getElementById('vencidasCount');
        const botaoElement = document.getElementById('filterVencidasBtn');

        badgeElement.textContent = contador;

        // Mostrar/esconder badge se n√£o h√° vencidas
        if (contador === 0) {
          badgeElement.style.display = 'none';
          // Se n√£o h√° vencidas e o filtro est√° ativo, desativ√°-lo
          if (filtroVencidasAtivo) {
            filtroVencidasAtivo = false;
            botaoElement.classList.remove('active');
          }
        } else {
          badgeElement.style.display = 'inline-flex';
        }
      }

      // Alternar filtro de vencidas - NOVA
      function toggleFiltroVencidas() {
        const botaoElement = document.getElementById('filterVencidasBtn');
        filtroVencidasAtivo = !filtroVencidasAtivo;

        if (filtroVencidasAtivo) {
          botaoElement.classList.add('active');
          // Alterar texto quando ativo
          botaoElement.innerHTML = '<span>‚ö†Ô∏è Mostrando Vencidas</span><span class="badge" id="vencidasCount">' + document.getElementById('vencidasCount').textContent + '</span>';
        } else {
          botaoElement.classList.remove('active');
          // Voltar texto original
          botaoElement.innerHTML = '<span>‚ö†Ô∏è Mostrar Vencidas</span><span class="badge" id="vencidasCount">' + document.getElementById('vencidasCount').textContent + '</span>';
        }

        renderCards(); // Re-renderizar os cards com o filtro aplicado
      }

      // Verificar se uma hist√≥ria est√° vencida - NOVA
      function historiaEstaVencida(historia) {
        if (!historia.prazoRevisao || !historia.dataConfiguracaoRevisao) {
          return false;
        }

        const hoje = new Date();
        const dataConfiguracao = new Date(historia.dataConfiguracaoRevisao);
        const dataVencimento = new Date(dataConfiguracao);
        dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

        const diffTime = dataVencimento - hoje;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        return diffDays < 0; // Vencida se dias negativos
      }

      function renderClientesList() {
        const container = document.getElementById('clientsList');
        const clientes = Object.keys(dados);

        if (clientes.length === 0) {
          container.innerHTML = `
          <h3>Clientes Cadastrados</h3>
          <div class="empty-state" style="padding: 20px; margin-top: 10px;">
            <p>Nenhum cliente cadastrado ainda.</p>
          </div>
        `;
          return;
        }

        let html = '<h3>Clientes Cadastrados</h3>';

        clientes.sort().forEach(cliente => {
          const numHistorias = dados[cliente].length;
          html += `
          <div class="client-item">
            <span>${cliente} <small style="color: var(--text-light);">(${numHistorias} hist√≥rias)</small></span>
            <div class="client-item-actions">
              <button class="secondary small" onclick="editarCliente('${cliente}')">Editar</button>
              <button class="danger small" onclick="excluirCliente('${cliente}')">Excluir</button>
            </div>
          </div>
        `;
        });

        container.innerHTML = html;
      }

      function addCliente() {
        const nomeInput = document.getElementById('clienteNome');
        const nome = nomeInput.value.trim();

        if (!nome) {
          alert('Por favor, digite um nome para o cliente.');
          nomeInput.focus();
          return;
        }

        if (dados[nome]) {
          alert('J√° existe um cliente com esse nome.');
          nomeInput.focus();
          return;
        }

        dados[nome] = [];
        salvar();
        atualizarSelects();
        renderClientesList();
        nomeInput.value = "";
        nomeInput.focus();
      }

      function editarCliente(cliente) {
        editClienteNome = cliente;
        document.getElementById('editClienteNome').value = cliente;
        document.getElementById('modalCliente').classList.add('active');
        document.getElementById('editClienteNome').focus();
      }

      function fecharModalCliente() {
        document.getElementById('modalCliente').classList.remove('active');
        editClienteNome = null;
      }

      function salvarEdicaoCliente() {
        const novoNome = document.getElementById('editClienteNome').value.trim();

        if (!novoNome) {
          alert('O nome do cliente n√£o pode estar vazio.');
          document.getElementById('editClienteNome').focus();
          return;
        }

        if (novoNome !== editClienteNome && dados[novoNome]) {
          alert('J√° existe um cliente com esse nome.');
          document.getElementById('editClienteNome').focus();
          return;
        }

        if (novoNome !== editClienteNome) {
          // Renomear o cliente
          dados[novoNome] = dados[editClienteNome];
          delete dados[editClienteNome];

          // Atualizar o nome do cliente em todas as hist√≥rias
          dados[novoNome].forEach(historia => {
            historia.cliente = novoNome;
          });
        }

        salvar();
        atualizarSelects();
        renderCards();
        renderClientesList();
        fecharModalCliente();
      }

      function excluirCliente(cliente) {
        if (dados[cliente].length > 0) {
          if (!confirm(`O cliente "${cliente}" tem ${dados[cliente].length} hist√≥rias. Tem certeza que deseja excluir o cliente e todas as suas hist√≥rias?`)) {
            return;
          }
        } else {
          if (!confirm(`Tem certeza que deseja excluir o cliente "${cliente}"?`)) {
            return;
          }
        }

        delete dados[cliente];
        salvar();
        atualizarSelects();
        renderCards();
        renderClientesList();
      }

      function addCard() {
        const cliente = document.getElementById('clienteSelect').value;
        if (!cliente) {
          alert('Selecione um cliente primeiro.');
          return;
        }

        const titulo = document.getElementById('titulo').value.trim();
        const texto = document.getElementById('texto').value;
        const status = document.getElementById('status').value;

        if (!titulo) {
          alert('Por favor, digite um t√≠tulo para a hist√≥ria.');
          document.getElementById('titulo').focus();
          return;
        }

        const dataAtual = new Date().toISOString().split('T')[0];
        const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        // Criar a primeira anota√ß√£o com o conte√∫do da hist√≥ria
        const primeiraAnotacao = {
          texto: texto,
          data: dataAtual,
          hora: horaAtual
        };

        dados[cliente].push({
          titulo: titulo,
          status: status,
          dataCriacao: dataAtual,
          horaCriacao: horaAtual,
          dataEdicao: dataAtual,
          horaEdicao: horaAtual,
          cliente: cliente,
          notas: [primeiraAnotacao], // O conte√∫do agora √© a primeira anota√ß√£o
          // N√ÉO adicionamos prazo de revis√£o por padr√£o na cria√ß√£o
        });

        salvar();
        renderCards();

        // Limpar os campos, mas manter o cliente selecionado
        document.getElementById('titulo').value = '';
        document.getElementById('texto').value = '';

        // Foco no campo de texto para pr√≥xima hist√≥ria
        document.getElementById('texto').focus();

        // Voltar para a se√ß√£o de hist√≥rias salvas ap√≥s criar
        document.querySelector('.menu-item[data-section="historias-salvas"]').click();
      }

      function renderCards() {
        const container = document.getElementById('cards');
        const clienteSelecionado = document.getElementById('clienteSelectCards').value;
        const statusSelecionado = document.getElementById('statusFilter').value;

        // Verificar se h√° dados
        const totalHistorias = Object.values(dados).reduce((total, arr) => total + arr.length, 0);

        if (totalHistorias === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>Adicione clientes e crie hist√≥rias usando o menu.</p>
          </div>
        `;
          return;
        }

        // Se filtro de vencidas est√° ativo, mostrar apenas vencidas
        if (filtroVencidasAtivo) {
          mostrarApenasVencidas(container, clienteSelecionado, statusSelecionado);
        } else if (!clienteSelecionado && !statusSelecionado) {
          mostrarTodasHistorias(container);
        } else {
          mostrarHistoriasFiltradas(container, clienteSelecionado, statusSelecionado);
        }
      }

      // Nova fun√ß√£o para mostrar apenas hist√≥rias vencidas
      function mostrarApenasVencidas(container, clienteFiltro, statusFiltro) {
        container.innerHTML = '';

        let historiasVencidas = [];
        let clientesComHistoriasVencidas = [];

        // Coletar apenas hist√≥rias vencidas que correspondem aos filtros
        Object.keys(dados).forEach(cliente => {
          if (!clienteFiltro || cliente === clienteFiltro) {
            dados[cliente].forEach(historia => {
              if (historiaEstaVencida(historia)) {
                if (!statusFiltro || historia.status === statusFiltro) {
                  historiasVencidas.push({
                    cliente: cliente,
                    historia: historia,
                    index: dados[cliente].indexOf(historia)
                  });

                  if (!clientesComHistoriasVencidas.includes(cliente)) {
                    clientesComHistoriasVencidas.push(cliente);
                  }
                }
              }
            });
          }
        });

        if (historiasVencidas.length === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria vencida</h3>
            <p>N√£o h√° hist√≥rias vencidas que correspondam aos filtros selecionados.</p>
          </div>
        `;
          return;
        }

        // T√≠tulo para o filtro de vencidas
        const filtroTitle = document.createElement('div');
        filtroTitle.style.cssText = `
        grid-column: 1 / -1;
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--danger);
        display: flex;
        align-items: center;
        gap: 8px;
      `;

        let titulo = '‚ö†Ô∏è Hist√≥rias Vencidas';
        if (clienteFiltro) {
          titulo = `‚ö†Ô∏è Hist√≥rias Vencidas - Cliente: ${clienteFiltro}`;
        }
        if (statusFiltro) {
          titulo += ` (Status: ${statusFiltro})`;
        }
        titulo += ` (${historiasVencidas.length} hist√≥rias)`;

        filtroTitle.innerHTML = `${titulo} <span style="margin-left: auto; font-size: 12px; color: var(--text-light); cursor: pointer;" onclick="toggleFiltroVencidas()">[Mostrar todas]</span>`;
        container.appendChild(filtroTitle);

        // Agrupar por cliente para melhor organiza√ß√£o
        const historiasPorCliente = {};

        historiasVencidas.forEach(item => {
          if (!historiasPorCliente[item.cliente]) {
            historiasPorCliente[item.cliente] = [];
          }
          historiasPorCliente[item.cliente].push(item);
        });

        // Adicionar cards agrupados por cliente
        Object.keys(historiasPorCliente).forEach(cliente => {
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 15px;
          font-weight: 600;
          color: var(--text);
          margin: 20px 0 8px 0;
          padding-bottom: 6px;
          border-bottom: 1px solid var(--border);
        `;
          clienteTitle.textContent = `Cliente: ${cliente}`;
          container.appendChild(clienteTitle);

          historiasPorCliente[cliente].forEach(item => {
            container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
          });
        });
      }

      function mostrarTodasHistorias(container) {
        container.innerHTML = '';

        Object.keys(dados).forEach(cliente => {
          if (dados[cliente].length > 0) {
            // Adicionar t√≠tulo do cliente
            const clienteTitle = document.createElement('div');
            clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin: 16px 0 8px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
          `;
            clienteTitle.textContent = `Cliente: ${cliente}`;
            container.appendChild(clienteTitle);

            // Adicionar cards do cliente
            dados[cliente].forEach((historia, index) => {
              container.appendChild(criarCardElement(cliente, historia, index));
            });
          }
        });
      }

      function mostrarHistoriasFiltradas(container, clienteFiltro, statusFiltro) {
        container.innerHTML = '';

        let historiasFiltradas = [];
        let clientesComHistorias = [];

        // Coletar todas as hist√≥rias que correspondem aos filtros
        Object.keys(dados).forEach(cliente => {
          if (!clienteFiltro || cliente === clienteFiltro) {
            dados[cliente].forEach(historia => {
              if (!statusFiltro || historia.status === statusFiltro) {
                historiasFiltradas.push({
                  cliente: cliente,
                  historia: historia,
                  index: dados[cliente].indexOf(historia)
                });

                if (!clientesComHistorias.includes(cliente)) {
                  clientesComHistorias.push(cliente);
                }
              }
            });
          }
        });

        if (historiasFiltradas.length === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <h3>Nenhuma hist√≥ria encontrada</h3>
            <p>N√£o h√° hist√≥rias que correspondam aos filtros selecionados.</p>
          </div>
        `;
          return;
        }

        // Mostrar por cliente ou todas juntas dependendo dos filtros
        if (clienteFiltro) {
          // Filtro por cliente espec√≠fico
          const clienteTitle = document.createElement('div');
          clienteTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 16px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

          let titulo = `Cliente: ${clienteFiltro}`;
          if (statusFiltro) {
            titulo += ` (Filtrado por status: ${statusFiltro})`;
          }
          titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

          clienteTitle.textContent = titulo;
          container.appendChild(clienteTitle);

          // Adicionar cards filtrados
          historiasFiltradas.forEach(item => {
            container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
          });
        } else {
          // Filtro apenas por status (ou nenhum filtro)
          const filtroTitle = document.createElement('div');
          filtroTitle.style.cssText = `
          grid-column: 1 / -1;
          font-size: 16px;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 16px;
          padding-bottom: 8px;
          border-bottom: 2px solid var(--primary);
        `;

          let titulo = 'Todas as hist√≥rias';
          if (statusFiltro) {
            titulo = `Hist√≥rias com status: ${statusFiltro}`;
          }
          titulo += ` (${historiasFiltradas.length} hist√≥rias)`;

          filtroTitle.textContent = titulo;
          container.appendChild(filtroTitle);

          // Agrupar por cliente para melhor organiza√ß√£o
          const historiasPorCliente = {};

          historiasFiltradas.forEach(item => {
            if (!historiasPorCliente[item.cliente]) {
              historiasPorCliente[item.cliente] = [];
            }
            historiasPorCliente[item.cliente].push(item);
          });

          // Adicionar cards agrupados por cliente
          Object.keys(historiasPorCliente).forEach(cliente => {
            const clienteTitle = document.createElement('div');
            clienteTitle.style.cssText = `
            grid-column: 1 / -1;
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin: 20px 0 8px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
          `;
            clienteTitle.textContent = `Cliente: ${cliente}`;
            container.appendChild(clienteTitle);

            historiasPorCliente[cliente].forEach(item => {
              container.appendChild(criarCardElement(item.cliente, item.historia, item.index));
            });
          });
        }
      }

      function criarCardElement(cliente, historia, index) {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.status = historia.status;

        // Formatar data para exibi√ß√£o
        const dataCriacao = historia.dataCriacao || 'N√£o informado';
        const horaCriacao = historia.horaCriacao || '';
        const dataEdicao = historia.dataEdicao || dataCriacao;
        const horaEdicao = historia.horaEdicao || horaCriacao;

        // Verificar quantas anota√ß√µes existem
        const numAnotacoes = historia.notas ? historia.notas.length : 0;

        // Calcular status de revis√£o se existir
        let reviewBadge = '';
        if (historia.prazoRevisao && historia.dataConfiguracaoRevisao) {
          const hoje = new Date();
          const dataConfiguracao = new Date(historia.dataConfiguracaoRevisao);
          const dataVencimento = new Date(dataConfiguracao);
          dataVencimento.setDate(dataVencimento.getDate() + historia.prazoRevisao);

          const diffTime = dataVencimento - hoje;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          if (diffDays > 0) {
            // Ainda tem tempo
            reviewBadge = `<div class="review-badge future">‚è∞ Revisar em: ${diffDays} ${diffDays === 1 ? 'dia' : 'dias'}</div>`;
          } else if (diffDays === 0) {
            // Vence hoje
            reviewBadge = `<div class="review-badge today">‚è∞ Revisar hoje</div>`;
          } else {
            // Vencido
            const diasAtraso = Math.abs(diffDays);
            reviewBadge = `<div class="review-badge overdue">‚è∞ Vencido h√°: ${diasAtraso} ${diasAtraso === 1 ? 'dia' : 'dias'}</div>`;
          }
        }

        card.innerHTML = `
        <div class="card-header">
          <div style="flex: 1;">
            <h3>${historia.titulo}</h3>
            ${reviewBadge}
          </div>
          <span class="status" data-status="${historia.status}">${historia.status}</span>
        </div>
        
        <div class="card-dates">
          <div class="date-info">
            <span class="label">Criado em:</span>
            <span class="value">${dataCriacao} ${horaCriacao ? `√†s ${horaCriacao}` : ''}</span>
          </div>
          <div class="date-info">
            <span class="label">Editado em:</span>
            <span class="value">${dataEdicao} ${horaEdicao ? `√†s ${horaEdicao}` : ''}</span>
          </div>
          <div class="date-info">
            <span class="label">Anota√ß√µes:</span>
            <span class="value">${numAnotacoes} anota√ß√µes</span>
          </div>
        </div>
        
        <div class="card-footer">
          <div class="card-actions">
            <button class="secondary small" onclick="abrirModal('${cliente}', ${index})">Editar</button>
            <button class="danger small" onclick="excluir('${cliente}', ${index})">Excluir</button>
          </div>
        </div>
      `;

        return card;
      }

      function excluir(cliente, index) {
        if (!confirm("Tem certeza que deseja excluir esta hist√≥ria?")) return;

        dados[cliente].splice(index, 1);
        salvar();
        renderCards();

        // Atualizar selects se o cliente ficou sem hist√≥rias
        if (dados[cliente].length === 0) {
          atualizarSelects();
        }
      }

      function abrirModal(cliente, index) {
        editCliente = cliente;
        editIndex = index;

        const historia = dados[cliente][index];
        document.getElementById('editTitulo').value = historia.titulo;
        document.getElementById('editStatus').value = historia.status;
        document.getElementById('currentClienteName').textContent = cliente;

        // Configurar campos de revis√£o
        const reviewCheckbox = document.getElementById('editReviewCheckbox');
        const reviewFields = document.getElementById('reviewFields');
        const reviewDays = document.getElementById('editReviewDays');

        if (historia.prazoRevisao) {
          reviewCheckbox.checked = true;
          reviewFields.classList.remove('hidden');
          reviewDays.value = historia.prazoRevisao;
        } else {
          reviewCheckbox.checked = false;
          reviewFields.classList.add('hidden');
          reviewDays.value = 7; // Valor padr√£o
        }

        // Garantir que a propriedade notas exista
        if (!historia.notas) {
          historia.notas = [];
        }

        // Renderizar anota√ß√µes
        renderizarAnotacoes(historia.notas);

        document.getElementById('modal').classList.add('active');

        // Foco no t√≠tulo ao abrir o modal
        setTimeout(() => {
          document.getElementById('editTitulo').focus();
        }, 100);
      }

      function fecharModal() {
        document.getElementById('modal').classList.remove('active');
        editCliente = null;
        editIndex = null;
      }

      function toggleReviewFields() {
        const reviewCheckbox = document.getElementById('editReviewCheckbox');
        const reviewFields = document.getElementById('reviewFields');

        if (reviewCheckbox.checked) {
          reviewFields.classList.remove('hidden');
          document.getElementById('editReviewDays').focus();
        } else {
          reviewFields.classList.add('hidden');
        }
      }

      function salvarEdicao() {
        const titulo = document.getElementById('editTitulo').value.trim();

        if (!titulo) {
          alert('O t√≠tulo √© obrigat√≥rio.');
          document.getElementById('editTitulo').focus();
          return;
        }

        const dataAtual = new Date().toISOString().split('T')[0];
        const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        // Preservar dados existentes e atualizar
        const historiaExistente = dados[editCliente][editIndex];

        // Preservar anota√ß√µes se existirem
        const notas = historiaExistente.notas || [];

        // Verificar se deve adicionar/remover prazo de revis√£o
        const reviewCheckbox = document.getElementById('editReviewCheckbox');
        const reviewDays = document.getElementById('editReviewDays');

        let prazoRevisao = null;
        let dataConfiguracaoRevisao = null;

        if (reviewCheckbox.checked) {
          prazoRevisao = parseInt(reviewDays.value);
          if (isNaN(prazoRevisao) || prazoRevisao < 1 || prazoRevisao > 365) {
            alert('Por favor, insira um n√∫mero v√°lido de dias (1-365).');
            reviewDays.focus();
            return;
          }
          // Se j√° tinha uma data de configura√ß√£o, mant√©m. Se n√£o, cria nova.
          dataConfiguracaoRevisao = historiaExistente.dataConfiguracaoRevisao || dataAtual;
        }

        dados[editCliente][editIndex] = {
          titulo: titulo,
          status: document.getElementById('editStatus').value,
          dataCriacao: historiaExistente.dataCriacao || dataAtual,
          horaCriacao: historiaExistente.horaCriacao || horaAtual,
          dataEdicao: dataAtual,
          horaEdicao: horaAtual,
          cliente: editCliente,
          notas: notas, // Preservar anota√ß√µes
          prazoRevisao: prazoRevisao,
          dataConfiguracaoRevisao: dataConfiguracaoRevisao
        };

        salvar();
        fecharModal();
        renderCards();
      }

      // FUN√á√ïES PARA ANOTA√á√ïES
      function renderizarAnotacoes(notas) {
        const container = document.getElementById('notesContainer');

        if (!notas || notas.length === 0) {
          container.innerHTML = `
          <div class="note-item">
            <div class="note-content note-content-placeholder">
              Nenhuma anota√ß√£o ainda. Clique em "Nova Anota√ß√£o" para adicionar.
            </div>
          </div>
        `;
          return;
        }

        container.innerHTML = '';

        notas.forEach((nota, index) => {
          const noteElement = document.createElement('div');
          noteElement.className = 'note-item';
          noteElement.innerHTML = `
          <div class="note-header">
            <span class="note-date">${nota.data} ${nota.hora ? `√†s ${nota.hora}` : ''}</span>
            <button class="note-expand-btn" onclick="alternarExpansaoAnotacao(${index})">+</button>
          </div>
          <div class="note-content" id="noteContent${index}">
            ${nota.texto || ''}
          </div>
          <div class="note-actions">
            <button class="secondary small" onclick="editarAnotacao(${index})">Editar</button>
            <button class="danger small" onclick="excluirAnotacao(${index})">Excluir</button>
          </div>
        `;
          container.appendChild(noteElement);
        });
      }

      function adicionarNovaAnotacao() {
        const container = document.getElementById('notesContainer');

        // Se estiver mostrando a mensagem de "nenhuma anota√ß√£o", remov√™-la
        if (container.innerHTML.includes('Nenhuma anota√ß√£o')) {
          container.innerHTML = '';
        }

        const dataAtual = new Date().toISOString().split('T')[0];
        const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        const novaNota = {
          texto: '',
          data: dataAtual,
          hora: horaAtual,
          editando: true
        };

        // Adicionar √† array de anota√ß√µes da hist√≥ria atual
        if (!dados[editCliente][editIndex].notas) {
          dados[editCliente][editIndex].notas = [];
        }

        dados[editCliente][editIndex].notas.push(novaNota);
        salvar();

        // Renderizar anota√ß√µes novamente
        renderizarAnotacoes(dados[editCliente][editIndex].notas);
      }

      function alternarExpansaoAnotacao(index) {
        const noteContent = document.getElementById(`noteContent${index}`);
        const expandBtn = document.querySelectorAll('.note-expand-btn')[index];

        if (noteContent.classList.contains('expanded')) {
          noteContent.classList.remove('expanded');
          expandBtn.textContent = '+';
        } else {
          noteContent.classList.add('expanded');
          expandBtn.textContent = '-';
        }
      }

      function editarAnotacao(index) {
        const notas = dados[editCliente][editIndex].notas;
        const nota = notas[index];

        // Criar input de edi√ß√£o
        const noteItem = document.querySelectorAll('.note-item')[index];
        noteItem.innerHTML = `
        <div class="note-header">
          <span class="note-date">${nota.data} ${nota.hora ? `√†s ${nota.hora}` : ''}</span>
        </div>
        <textarea class="note-edit-input" id="editNoteInput${index}">${nota.texto || ''}</textarea>
        <div class="note-actions">
          <button class="secondary small" onclick="cancelarEdicaoAnotacao(${index})">Cancelar</button>
          <button class="primary small" onclick="salvarEdicaoAnotacao(${index})">Salvar</button>
        </div>
      `;

        // Focar no input de edi√ß√£o
        setTimeout(() => {
          document.getElementById(`editNoteInput${index}`).focus();
        }, 100);
      }

      function salvarEdicaoAnotacao(index) {
        const notas = dados[editCliente][editIndex].notas;
        const nota = notas[index];
        const novoTexto = document.getElementById(`editNoteInput${index}`).value.trim();

        if (novoTexto) {
          nota.texto = novoTexto;
          nota.data = new Date().toISOString().split('T')[0];
          nota.hora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

          salvar();
          renderizarAnotacoes(notas);
        } else {
          alert('A anota√ß√£o n√£o pode estar vazia.');
          document.getElementById(`editNoteInput${index}`).focus();
        }
      }

      function cancelarEdicaoAnotacao(index) {
        renderizarAnotacoes(dados[editCliente][editIndex].notas);
      }

      function excluirAnotacao(index) {
        if (!confirm('Tem certeza que deseja excluir esta anota√ß√£o?')) return;

        dados[editCliente][editIndex].notas.splice(index, 1);
        salvar();
        renderizarAnotacoes(dados[editCliente][editIndex].notas);
      }

      // FUN√á√ïES PARA IMPORTAR/EXPORTAR DADOS
      function exportarDados() {
        // Obter todos os dados do localStorage
        const dadosCompletos = {
          clientes: dados,
          exportadoEm: new Date().toISOString(),
          versao: '1.2' // Atualizado para incluir prazos de revis√£o
        };

        // Converter para JSON
        const jsonDados = JSON.stringify(dadosCompletos, null, 2);

        // Criar um blob e fazer download
        const blob = new Blob([jsonDados], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `historias-clientes-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('Dados exportados com sucesso!');
      }

      function importarDados() {
        const fileInput = document.getElementById('jsonFile');
        const file = fileInput.files[0];

        if (!file) {
          alert('Por favor, selecione um arquivo JSON para importar.');
          return;
        }

        if (!confirm('ATEN√á√ÉO: Isso ir√° substituir todos os dados atuais. Tem certeza que deseja continuar?')) {
          return;
        }

        const reader = new FileReader();

        reader.onload = function (e) {
          try {
            const dadosImportados = JSON.parse(e.target.result);

            // Verificar se √© um formato v√°lido
            if (!dadosImportados.clientes) {
              throw new Error('Formato de arquivo inv√°lido. O arquivo deve conter dados de clientes.');
            }

            // Atualizar os dados
            dados = dadosImportados.clientes;
            salvar();

            // Atualizar a interface
            atualizarSelects();
            atualizarContadorVencidas();
            renderCards();
            renderClientesList();

            // Limpar o input de arquivo
            fileInput.value = '';

            alert('Dados importados com sucesso!');
          } catch (error) {
            alert(`Erro ao importar dados: ${error.message}`);
            console.error('Erro na importa√ß√£o:', error);
          }
        };

        reader.onerror = function () {
          alert('Erro ao ler o arquivo. Por favor, tente novamente.');
        };

        reader.readAsText(file);
      }

      function excluirTodosDados() {
        if (!confirm('ATEN√á√ÉO: Esta a√ß√£o excluir√° permanentemente TODOS os dados (clientes, hist√≥rias, cards e anota√ß√µes). Esta a√ß√£o N√ÉO pode ser desfeita.\n\nTem certeza absoluta que deseja continuar?')) {
          return;
        }

        if (!confirm('√öLTIMO AVISO: Todos os seus dados ser√£o PERDIDOS para sempre. Clique em OK apenas se tiver certeza absoluta.')) {
          return;
        }

        dados = {};
        salvar();
        atualizarSelects();
        atualizarContadorVencidas();
        renderCards();
        renderClientesList();

        alert('Todos os dados foram exclu√≠dos com sucesso.');
      }

      // Fechar modal com ESC
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape' && document.getElementById('modal').classList.contains('active')) {
          fecharModal();
        }
        if (event.key === 'Escape' && document.getElementById('modalCliente').classList.contains('active')) {
          fecharModalCliente();
        }
      });
    </script>

</body>

</html>
